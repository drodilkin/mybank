<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROFIT BANK | HYPER SPEED</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent: #ffd600;
            --accent-glow: rgba(255, 214, 0, 0.4);
            --bg: #050508;
            --card-bg: #0d0d18;
            --panel: #161625;
            --text: #ffffff;
            --muted: #808090;
            --success: #00ffa3;
            --error: #ff2e63;
            --border: rgba(255, 255, 255, 0.08);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none !important; }
        body { 
            margin: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif;
            background-image: radial-gradient(circle at 50% -10%, #1e1e3f 0%, #050508 100%);
            min-height: 100vh; overflow-x: hidden;
        }

        .hidden { display: none !important; }

        /* --- –ê–ù–ò–ú–ê–¶–ò–ò --- */
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse-success { 0% { box-shadow: 0 0 0 0 rgba(0, 255, 163, 0.4); } 70% { box-shadow: 0 0 0 20px rgba(0, 255, 163, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 255, 163, 0); } }
        @keyframes count-up { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .container { width: 100%; max-width: 480px; margin: 0 auto; padding: 20px; animation: slideUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1); }

        /* --- –ö–ê–†–¢–ê 3D (FIXED) --- */
        .card-scene { perspective: 1500px; height: 250px; margin-bottom: 30px; }
        .card-obj {
            width: 100%; height: 100%; position: relative;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d; cursor: pointer;
        }
        .card-obj.is-flipped { transform: rotateY(180deg); }

        .card-side {
            position: absolute; inset: 0; border-radius: 30px; padding: 30px;
            backface-visibility: hidden; border: 1px solid var(--border);
            display: flex; flex-direction: column; justify-content: space-between;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .card-front { background: linear-gradient(135deg, #1c1c2e 0%, #0a0a0f 100%); }
        .card-back { background: #08080c; transform: rotateY(180deg); align-items: center; justify-content: center; }

        .chip { width: 50px; height: 40px; background: linear-gradient(135deg, #ffd600, #b88a00); border-radius: 8px; }
        .balance-num { font-family: 'Orbitron'; font-size: 38px; font-weight: 900; margin: 10px 0; color: var(--text); transition: 0.5s; }
        .card-number { font-family: 'JetBrains Mono'; font-size: 20px; letter-spacing: 4px; color: #fff; text-shadow: 0 2px 4px #000; }

        /* --- –ù–ê–í–ò–ì–ê–¶–ò–Ø --- */
        .nav-bar {
            display: flex; background: var(--panel); padding: 8px; border-radius: 20px;
            border: 1px solid var(--border); margin-bottom: 25px; gap: 5px;
            position: sticky; top: 10px; z-index: 1000; backdrop-filter: blur(10px);
        }
        .nav-item {
            flex: 1; padding: 12px 2px; border: none; background: none; color: var(--muted);
            font-size: 10px; font-weight: 800; border-radius: 15px; cursor: pointer;
            transition: 0.3s; text-transform: uppercase; letter-spacing: 1px;
        }
        .nav-item.active { background: var(--accent); color: #000; box-shadow: 0 5px 15px var(--accent-glow); }

        /* --- –ü–ê–ù–ï–õ–ò --- */
        .glass-view {
            background: var(--card-bg); border-radius: 30px; padding: 25px;
            border: 1px solid var(--border); margin-bottom: 20px;
        }
        h2 { font-size: 22px; font-weight: 900; margin: 0 0 20px; color: var(--accent); font-family: 'Orbitron'; }

        input, select {
            width: 100%; padding: 18px; background: #05050a; border: 1px solid var(--border);
            border-radius: 18px; color: #fff; font-size: 16px; margin-bottom: 15px; transition: 0.3s;
        }
        input:focus { border-color: var(--accent); background: #0d0d1a; }

        .btn-send {
            width: 100%; padding: 20px; background: var(--accent); border: none; border-radius: 18px;
            font-weight: 900; font-size: 16px; color: #000; cursor: pointer; transition: 0.2s;
            text-transform: uppercase; letter-spacing: 2px;
        }
        .btn-send:active { transform: scale(0.97); }

        /* --- –¢–†–ê–ù–ó–ê–ö–¶–ò–ò --- */
        .tx-list { display: flex; flex-direction: column; gap: 12px; max-height: 400px; overflow-y: auto; }
        .tx-item {
            display: flex; align-items: center; gap: 15px; padding: 15px;
            background: rgba(255,255,255,0.03); border-radius: 20px; border: 1px solid var(--border);
            animation: count-up 0.4s ease;
        }
        .tx-icon { width: 45px; height: 45px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .tx-info { flex: 1; }
        .tx-user { display: block; font-weight: 800; font-size: 14px; }
        .tx-date { font-size: 10px; color: var(--muted); }
        .tx-amt { font-family: 'JetBrains Mono'; font-weight: 900; font-size: 15px; }

        /* --- –ß–ê–¢ --- */
        .chat-wall { height: 350px; overflow-y: auto; display: flex; flex-direction: column-reverse; gap: 15px; }
        .chat-msg { display: flex; gap: 12px; max-width: 85%; align-items: flex-end; }
        .chat-msg.me { align-self: flex-end; flex-direction: row-reverse; }
        .chat-ava { width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--accent); background: #000; object-fit: cover; }
        .chat-bubble { padding: 12px 16px; border-radius: 20px; background: var(--panel); border: 1px solid var(--border); font-size: 14px; }
        .chat-msg.me .chat-bubble { background: var(--accent); color: #000; border: none; font-weight: 600; }

        /* --- LOADER --- */
        #loading-screen {
            position: fixed; inset: 0; background: var(--bg); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .loader-ring { width: 60px; height: 60px; border: 4px solid var(--panel); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="loader-ring"></div>
        <p style="margin-top:20px; color:var(--accent); font-family:'Orbitron'; font-size:12px; letter-spacing:5px;">SECURE CONNECTION</p>
    </div>

    <div id="login-view" style="min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px;">
        <div class="glass-view" style="width:100%; max-width:400px; text-align:center;">
            <h1 style="font-family:'Orbitron'; color:var(--accent); font-size:36px; margin:0;">PROFIT</h1>
            <p style="color:var(--muted); font-size:10px; letter-spacing:5px; margin-bottom:35px;">INFINITE SYSTEM</p>
            <input type="email" id="email" placeholder="EMAIL ID">
            <input type="password" id="pass" placeholder="PASSWORD">
            <button class="btn-send" onclick="startAuth()">–í–•–û–î</button>
        </div>
    </div>

    <div id="app-view" class="container hidden">
        
        <div class="card-scene">
            <div class="card-obj" id="main-card" onclick="this.classList.toggle('is-flipped')">
                <div class="card-side card-front">
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div class="chip"></div>
                        <img id="my-ava" src="" style="width:65px; height:65px; border-radius:50%; border:3px solid var(--accent); background:#111; object-fit:cover;">
                    </div>
                    <div>
                        <span style="font-size:11px; color:var(--muted); text-transform:uppercase; letter-spacing:2px;">–î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å</span>
                        <div class="balance-num" id="bal-text">0.00 ‚ÇΩ</div>
                        <div id="user-name" style="font-weight:800; text-transform:uppercase; font-size:14px; color:var(--accent);">---</div>
                    </div>
                </div>
                <div class="card-side card-back">
                    <div style="font-size:9px; color:var(--muted); margin-bottom:10px; letter-spacing:3px;">FOR ELITE CLIENTS ONLY</div>
                    <div class="card-number" id="card-num-text">0000 0000 0000 0000</div>
                    <div style="margin-top:20px; font-weight:900; color:var(--accent); font-size:12px;">PROFIT PLATINUM</div>
                </div>
            </div>
        </div>

        <nav class="nav-bar">
            <button class="nav-item active" onclick="showTab('pay', this)">–ü–ª–∞—Ç–µ–∂</button>
            <button class="nav-item" onclick="showTab('tx', this)">–ò—Å—Ç–æ—Ä–∏—è</button>
            <button class="nav-item" onclick="showTab('chat', this)">–ß–∞—Ç</button>
            <button class="nav-item" onclick="showTab('prof', this)">–ü—Ä–æ—Ñ–∏–ª—å</button>
        </nav>

        <div id="view-pay" class="glass-view tab-pane">
            <h2>üí∏ –ü–µ—Ä–µ–≤–æ–¥</h2>
            <select id="pay-to"></select>
            <input type="number" id="pay-amt" placeholder="–°—É–º–º–∞ (‚ÇΩ)">
            <input type="text" id="pay-comment" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ">
            <button class="btn-send" onclick="sendMoney()">–û–¢–ü–†–ê–í–ò–¢–¨ –ú–û–ú–ï–ù–¢–ê–õ–¨–ù–û</button>
        </div>

        <div id="view-tx" class="glass-view tab-pane hidden">
            <h2>üìú –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h2>
            <div id="tx-history" class="tx-list"></div>
        </div>

        <div id="view-chat" class="glass-view tab-pane hidden">
            <h2>üí¨ Profit Chat</h2>
            <div id="chat-box" class="chat-wall"></div>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <input type="text" id="chat-msg" placeholder="–¢–µ–∫—Å—Ç..." style="margin:0;">
                <button class="btn-send" style="width:60px; padding:0;" onclick="postChat()">></button>
            </div>
        </div>

        <div id="view-prof" class="glass-view tab-pane hidden">
            <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
            <div style="text-align:center; margin-bottom:30px;">
                <button class="btn-send" style="background:var(--panel); color:var(--accent); border:1px dashed var(--accent);" onclick="takePhoto()">üì∏ –û–ë–ù–û–í–ò–¢–¨ –ë–ò–û–ú–ï–¢–†–ò–Æ</button>
            </div>
            <div style="font-size:14px;">
                <div style="display:flex; justify-content:space-between; padding:15px 0; border-bottom:1px solid var(--border);">
                    <span style="color:var(--muted)">–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:</span><span style="color:var(--success); font-weight:800;">ONLINE</span>
                </div>
                <div style="display:flex; justify-content:space-between; padding:15px 0;">
                    <span style="color:var(--muted)">ID –ö–ª–∏–µ–Ω—Ç–∞:</span><span id="client-id" style="color:white;">---</span>
                </div>
            </div>
            <button onclick="location.reload()" style="width:100%; margin-top:40px; background:none; border:none; color:var(--error); font-weight:900; font-size:11px; cursor:pointer; letter-spacing:5px;">LOGOUT</button>
        </div>

    </div>

    <script>
        const API = 'https://script.google.com/macros/s/AKfycbzsLK9FxBEOFl4XDliOBm-qdmCRJL_Du4uOUjQrGqIdghrvqdt2_4YSbeNeSON2hDxrqg/exec';
        const CONTACTS = {
            'ilyasvaliev@mail.ru': { name: '–ò–ª—å—è—Å –í–∞–ª–∏–µ–≤', ava: 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png' },
            'prokhormart@mail.ru': { name: '–ü—Ä–æ—Ö–æ—Ä –ú–∞—Ä—Ç', ava: 'https://cdn-icons-png.flaticon.com/512/3135/3135768.png' },
            'romankisel@mail.ru': { name: '–†–æ–º–∞–Ω –ö–∏—Å–µ–ª—å', ava: 'https://cdn-icons-png.flaticon.com/512/4333/4333609.png' },
            'artemant@mail.ru': { name: '–ê—Ä—Ç–µ–º –ê–Ω—Ç', ava: 'https://cdn-icons-png.flaticon.com/512/1999/1999625.png' }
        };

        let me = { email: '', name: '', bal: 0, ava: '', history: [] };

        window.onload = () => setTimeout(() => document.getElementById('loading-screen').style.display = 'none', 1500);

        function showTab(id, el) {
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.add('hidden'));
            document.getElementById('view-'+id).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
        }

        async function startAuth() {
            const e = document.getElementById('email').value.toLowerCase().trim();
            const p = document.getElementById('pass').value.trim();
            if(!e || !p) return;

            setLoader(true);
            try {
                const res = await fetch(API, { method: 'POST', body: JSON.stringify({ action: 'login', email: e, password: p }) });
                const d = await res.json();
                if(d.success) {
                    me.email = e;
                    me.name = CONTACTS[e]?.name || e;
                    me.bal = d.balance;
                    me.ava = d.avatar || CONTACTS[e]?.ava || 'https://via.placeholder.com/100';
                    
                    document.getElementById('bal-text').innerText = me.bal.toLocaleString() + ' ‚ÇΩ';
                    document.getElementById('card-num-text').innerText = d.card;
                    document.getElementById('user-name').innerText = me.name;
                    document.getElementById('my-ava').src = me.ava;
                    document.getElementById('client-id').innerText = e;
                    
                    document.getElementById('login-view').classList.add('hidden');
                    document.getElementById('app-view').classList.remove('hidden');
                    
                    const sel = document.getElementById('pay-to');
                    sel.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è</option>';
                    for(let k in CONTACTS) if(k !== e) sel.innerHTML += `<option value="${k}">${CONTACTS[k].name}</option>`;
                    
                    sync();
                    setInterval(sync, 4000);
                } else { alert("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞!"); }
            } catch(x) { alert("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞!"); }
            setLoader(false);
        }

        async function sendMoney() {
            const to = document.getElementById('pay-to').value;
            const amt = parseFloat(document.getElementById('pay-amt').value);
            const comm = document.getElementById('pay-comment').value;
            if(!to || amt <= 0 || amt > me.bal) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");

            // –ú–û–ú–ï–ù–¢–ê–õ–¨–ù–ê–Ø –ê–ù–ò–ú–ê–¶–ò–Ø (Client-side update)
            const oldBal = me.bal;
            me.bal -= amt;
            animateValue('bal-text', oldBal, me.bal, 600);
            
            // –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            const res = await fetch(API, { method: 'POST', body: JSON.stringify({ action: 'transfer', from: me.email, to, amount: amt, comment: comm }) });
            const d = await res.json();
            if(d.success) {
                if(window.navigator.vibrate) window.navigator.vibrate([50, 30, 50]);
                document.getElementById('pay-amt').value = '';
                document.getElementById('pay-comment').value = '';
                sync();
            }
        }

        async function sync() {
            if(!me.email) return;
            const bRes = await fetch(API, { method: 'POST', body: JSON.stringify({ action: 'balance', email: me.email }) });
            const bD = await bRes.json();
            
            if(bD.balance !== me.bal) {
                animateValue('bal-text', me.bal, bD.balance, 500);
                me.bal = bD.balance;
            }

            // –¢–†–ê–ù–ó–ê–ö–¶–ò–ò
            const hRes = await fetch(API, { method: 'POST', body: JSON.stringify({ action: 'history', email: me.email }) });
            const hD = await hRes.json();
            
            document.getElementById('tx-history').innerHTML = hD.history.map(h => {
                const isOut = h[1].toLowerCase() === me.email;
                const partner = CONTACTS[isOut ? h[2] : h[1]]?.name || '–í–Ω–µ—à–Ω–∏–π —Å—á–µ—Ç';
                const date = h[0];
                return `
                    <div class="tx-item">
                        <div class="tx-icon" style="background:${isOut?'#25151b':'#15251e'}; color:${isOut?'var(--error)':'var(--success)'}">
                            ${isOut ? '‚Üó' : '‚Üô'}
                        </div>
                        <div class="tx-info">
                            <span class="tx-user">${partner}</span>
                            <span class="tx-date">${h[4] || '–ë–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è'} ‚Ä¢ ${date}</span>
                        </div>
                        <div class="tx-amt" style="color:${isOut?'var(--error)':'var(--success)'}">
                            ${isOut?'-':'+'}${h[3]} ‚ÇΩ
                        </div>
                    </div>
                `;
            }).join('');

           // –ß–ê–¢
            const cRes = await fetch(API, { method: 'POST', body: JSON.stringify({ action: 'chat', sub: 'get' }) });
            const cD = await cRes.json();
            document.getElementById('chat-box').innerHTML = cD.messages.map(m => {
                const isMe = m[1] === me.name;
                let sAva = 'https://via.placeholder.com/40';
                for(let k in CONTACTS) if(CONTACTS[k].name === m[1]) sAva = CONTACTS[k].ava;
                if(isMe) sAva = me.ava;

                return `
                    <div class="chat-msg ${isMe ? 'me' : ''}">
                        <img src="${sAva}" class="chat-ava">
                        <div class="chat-bubble">
                            <span style="display:block; font-size:9px; font-weight:800; color:var(--muted); margin-bottom:4px;">${m[1]}</span>
                            ${m[2]}
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function postChat() {
            const i = document.getElementById('chat-msg');
            if(!i.value.trim()) return;
            await fetch(API, { method: 'POST', body: JSON.stringify({ action: 'chat', sub: 'send', email: me.email, name: me.name, text: i.value }) });
            i.value = '';
            sync();
        }

        async function takePhoto() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                const video = document.createElement('video'); video.srcObject = stream; await video.play();
                setTimeout(async () => {
                    const c = document.createElement('canvas'); c.width = 400; c.height = 400;
                    c.getContext('2d').drawImage(video, 0, 0, 400, 400);
                    const base64 = c.toDataURL('image/jpeg', 0.6);
                    me.ava = base64;
                    document.getElementById('my-ava').src = base64;
                    await fetch(API, { method: 'POST', body: JSON.stringify({ action: 'updateAvatar', email: me.email, image: base64 }) });
                    stream.getTracks().forEach(t => t.stop());
                    alert("–§–æ—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!");
                    sync();
                }, 1500);
            } catch(e) { alert("–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"); }
        }

        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            const range = end - start;
            let current = start;
            const increment = end > start ? 1 : -1;
            const stepTime = Math.abs(Math.floor(duration / range));
            if (range === 0) return;
            const timer = setInterval(() => {
                current += increment * (Math.abs(range) / (duration / 10));
                obj.innerText = Math.floor(current).toLocaleString() + ' ‚ÇΩ';
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    obj.innerText = end.toLocaleString() + ' ‚ÇΩ';
                    clearInterval(timer);
                }
            }, 10);
        }

        function setLoader(s) { document.getElementById('loading-screen').style.display = s ? 'flex' : 'none'; }
    </script>
</body>
</html>
