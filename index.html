<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>PayBank</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg:#0b0b10;
  --card:#17171f;
  --input:#222230;
  --accent:#ffd600;
  --text:#fff;
  --muted:#9b9ba3;
}

* {
  box-sizing:border-box;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
}

body {
  margin:0;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.hidden { display:none; }

/* ===== AUTH ===== */
.auth {
  background:var(--card);
  padding:28px;
  border-radius:22px;
  width:100%;
  max-width:360px;
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}

.auth h1 {
  text-align:center;
  margin-bottom:20px;
}

.auth input, .auth button {
  width:100%;
  margin-top:12px;
  padding:14px;
  border:none;
  border-radius:14px;
  font-size:16px;
}

.auth input {
  background:var(--input);
  color:white;
}

.auth button {
  background:var(--accent);
  font-weight:600;
  cursor:pointer;
}

/* ===== APP ===== */
.app {
  width:100%;
  max-width:420px;
  padding:16px;
}

/* ===== CARD ===== */
.card-wrap {
  perspective:1000px;
}

.card {
  width:100%;
  height:160px;
  border-radius:22px;
  background:var(--card);
  padding:20px;
  transition:transform .7s;
  transform-style:preserve-3d;
  cursor:pointer;
}

.card.flipped {
  transform:rotateY(180deg);
}

.card-face {
  position:absolute;
  inset:0;
  backface-visibility:hidden;
}

.card-back {
  transform:rotateY(180deg);
  display:flex;
  flex-direction:column;
  justify-content:center;
}

.balance-title {
  color:var(--muted);
}

.balance-amount {
  font-size:34px;
  margin-top:6px;
}

/* ===== TRANSFER ===== */
.block {
  background:var(--card);
  border-radius:22px;
  padding:18px;
  margin-top:16px;
}

.block input, .block select, .block button {
  width:100%;
  margin-top:12px;
  padding:14px;
  border:none;
  border-radius:14px;
  font-size:15px;
}

.block input, .block select {
  background:var(--input);
  color:white;
}

.block button {
  background:var(--accent);
  font-weight:600;
  cursor:pointer;
}

/* ===== HISTORY ===== */
.history-item {
  padding:12px 0;
  border-bottom:1px solid #2a2a36;
}

.history-item:last-child {
  border:none;
}

.in { color:#2ecc71; }
.out { color:#ff4d4f; }

.logout {
  margin-top:14px;
  background:#2a2a36 !important;
  color:white;
}
</style>
</head>

<body>

<!-- ===== AUTH ===== -->
<div class="auth" id="auth">
  <h1>PayBank</h1>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Пароль">
  <button onclick="login()">Войти</button>
</div>

<!-- ===== APP ===== -->
<div class="app hidden" id="app">

  <!-- CARD -->
  <div class="card-wrap">
    <div class="card" id="bankCard" onclick="flipCard()">
      <div class="card-face">
        <div class="balance-title">Баланс</div>
        <div class="balance-amount" id="balance">0 ₽</div>
      </div>
      <div class="card-face card-back">
        <div class="balance-title">Номер карты</div>
        <div class="balance-amount" id="cardNumber"></div>
      </div>
    </div>
  </div>

  <!-- TRANSFER -->
  <div class="block">
    <select id="to">
      <option value="">Получатель</option>
    </select>
    <input id="amount" type="number" placeholder="Сумма">
    <input id="comment" placeholder="Комментарий">
    <button onclick="transfer()">Перевести</button>
  </div>

  <!-- HISTORY -->
  <div class="block" id="history"></div>

  <button class="block logout" onclick="logout()">Выйти</button>

</div>

<script>
const API = 'https://script.google.com/macros/s/AKfycbwZEBJyhpvNpjA9cuv1hfMy51IvvILbLR6-fh27IKiMRQ2azsyzCROTuIJeWYX9Gu9ytw/exec';

let userEmail = '';

async function login() {
  const email = emailInput.value.trim();
  const password = passwordInput.value.trim();

  const r = await fetch(API, {
    method:'POST',
    body:JSON.stringify({ action:'login', email, password })
  });

  const d = await r.json();
  if (!d.success) return alert('Неверные данные');

  userEmail = email;
  localStorage.setItem('user', email);

  balance.textContent = d.balance + ' ₽';
  cardNumber.textContent = d.card;

  auth.classList.add('hidden');
  app.classList.remove('hidden');

  loadUsers();
  loadHistory();
}

function flipCard() {
  bankCard.classList.toggle('flipped');
}

async function loadUsers() {
  const list = [
    'ilyasvaliev@mail.ru',
    'prokhormart@mail.ru',
    'romankisel@mail.ru',
    'artemant@mail.ru'
  ];

  to.innerHTML = '<option value="">Получатель</option>';
  list.filter(e => e !== userEmail).forEach(e => {
    const o = document.createElement('option');
    o.value = e;
    o.textContent = e;
    to.appendChild(o);
  });
}

async function transfer() {
  const amountVal = Number(amount.value);
  if (!to.value || amountVal <= 0) return;

  await fetch(API, {
    method:'POST',
    body:JSON.stringify({
      action:'transfer',
      from:userEmail,
      to:to.value,
      amount:amountVal,
      comment:comment.value
    })
  });

  comment.value='';
  amount.value='';
  loadHistory();
}

async function loadHistory() {
  const r = await fetch(API,{
    method:'POST',
    body:JSON.stringify({ action:'history', email:userEmail })
  });
  const d = await r.json();

  history.innerHTML='<h3>История</h3>';
  d.history.forEach(h=>{
    const div=document.createElement('div');
    const type=h[1]===userEmail?'out':'in';
    div.className='history-item '+type;
    div.innerHTML=`${type==='out'?'⬇':'⬆'} ${h[3]} ₽<br><small>${h[4]}</small>`;
    history.appendChild(div);
  });
}

function logout() {
  localStorage.clear();
  location.reload();
}

const emailInput=document.getElementById('email');
const passwordInput=document.getElementById('password');
</script>

</body>
</html>
