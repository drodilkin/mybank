<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>PayBank</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
--bg:#0b0b10;
--card:#17171f;
--input:#222230;
--accent:#ffd600;
--text:#fff;
--muted:#9b9ba3;
}

*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;}

body{
margin:0;
background:var(--bg);
color:var(--text);
min-height:100vh;
display:flex;
justify-content:center;
align-items:center;
}

.hidden{display:none;}

.auth{background:var(--card);padding:28px;border-radius:22px;width:100%;max-width:360px;}

.auth input,.auth button{
width:100%;
margin-top:12px;
padding:14px;
border:none;
border-radius:14px;
}

.auth input{background:var(--input);color:white;}
.auth button{background:var(--accent);font-weight:600;cursor:pointer;}

.app{width:100%;max-width:420px;padding:16px;}

.card-wrap{perspective:1000px;}

.card{
width:100%;
height:170px;
border-radius:22px;
background:linear-gradient(135deg,#1e1e28,#121218);
padding:20px;
transition:.5s;
transform-style:preserve-3d;
cursor:pointer;
position:relative;
}

.card.nfc{
animation:pulse 1s infinite;
}

@keyframes pulse{
0%{transform:scale(1);}
50%{transform:scale(1.05);}
100%{transform:scale(1);}
}

.card.flipped{transform:rotateY(180deg);}

.card-face{
position:absolute;
inset:0;
padding:20px;
backface-visibility:hidden;
}

.card-back{
transform:rotateY(180deg);
display:flex;
flex-direction:column;
justify-content:center;
}

.balance-title{color:var(--muted);}
.balance-amount{font-size:34px;}

.block{background:var(--card);border-radius:22px;padding:18px;margin-top:16px;}

.block input,.block select,.block button{
width:100%;
margin-top:12px;
padding:14px;
border:none;
border-radius:14px;
}

.block input,.block select{background:var(--input);color:white;}
.block button{background:var(--accent);font-weight:600;cursor:pointer;}

.tabs{
display:flex;
gap:8px;
margin-top:16px;
}

.tab{
flex:1;
padding:12px;
border-radius:12px;
background:#2a2a36;
text-align:center;
cursor:pointer;
}

.tab.active{
background:var(--accent);
color:black;
}
</style>
</head>

<body>

<div class="auth" id="auth">
<h1>PayBank</h1>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
<button onclick="login()">–í–æ–π—Ç–∏</button>
</div>

<div class="app hidden" id="app">

<div class="card-wrap">
<div class="card" id="bankCard" onclick="flipCard()">
<div class="card-face">
<div class="balance-title">–ë–∞–ª–∞–Ω—Å</div>
<div class="balance-amount" id="balance">0 ‚ÇΩ</div>
</div>

<div class="card-face card-back">
<div class="balance-title">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</div>
<div class="balance-amount" id="cardNumber"></div>
</div>
</div>
</div>

<div class="tabs">
<div class="tab active" onclick="switchTab('transfer')">–ü–µ—Ä–µ–≤–æ–¥—ã</div>
<div class="tab" onclick="switchTab('nfc')">NFC</div>
</div>

<div id="transferTab">

<div class="block">
<select id="to"></select>
<input id="amount" type="number" placeholder="–°—É–º–º–∞">
<input id="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
<button onclick="transfer()">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
</div>

</div>

<div id="nfcTab" class="hidden">
<div class="block">
<button onclick="scanNFC()">üì≥ –ü—Ä–∏–ª–æ–∂–∏—Ç—å –∫–∞—Ä—Ç—É</button>
</div>
</div>

<div class="block">
<button onclick="downloadStatement()">–°–∫–∞—á–∞—Ç—å –≤—ã–ø–∏—Å–∫—É</button>
</div>

<div class="block" id="history"></div>

<button class="block logout" onclick="logout()">–í—ã–π—Ç–∏</button>

</div>

<script>
const API='https://script.google.com/macros/s/AKfycbzpREMs_CGdEJaD78SW7zzsepJdVh4cis93U9qdhz_uFBRPklq4YT3bf9jzmhUIEPRcPg/exec';

let userEmail='';
let autoUpdateInterval=null;

const names={
'ilyasvaliev@mail.ru':'–ò–ª—å—è—Å',
'prokhormart@mail.ru':'–ü—Ä–æ—Ö–æ—Ä',
'romankisel@mail.ru':'–†–æ–º–∞–Ω',
'artemant@mail.ru':'–ê—Ä—Ç–µ–º'
};

const bankCard=document.getElementById('bankCard');
const transferTab=document.getElementById('transferTab');
const nfcTab=document.getElementById('nfcTab');

function switchTab(tab){

document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));

if(tab==='transfer'){
transferTab.classList.remove('hidden');
nfcTab.classList.add('hidden');
document.querySelectorAll('.tab')[0].classList.add('active');
}else{
transferTab.classList.add('hidden');
nfcTab.classList.remove('hidden');
document.querySelectorAll('.tab')[1].classList.add('active');
}

}

async function scanNFC(){

if(!('NDEFReader' in window)){
alert('NFC –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
return;
}

try{

const ndef=new NDEFReader();

await ndef.scan();

bankCard.classList.add('nfc');

alert('–ü—Ä–∏–ª–æ–∂–∏ –∫–∞—Ä—Ç—É');

ndef.onreading=async event=>{

bankCard.classList.remove('nfc');

alert('–ö–∞—Ä—Ç–∞ —Å—á–∏—Ç–∞–Ω–∞');

await refreshBalance();
};

}catch(e){
alert('–û—à–∏–±–∫–∞ NFC');
}

}

function flipCard(){
bankCard.classList.toggle('flipped');
}

async function login(){

const email=document.getElementById('email').value.trim();
const password=document.getElementById('password').value.trim();

const r=await fetch(API,{method:'POST',body:JSON.stringify({action:'login',email,password})});
const d=await r.json();

if(!d.success) return alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');

userEmail=email;
document.getElementById('balance').textContent=d.balance+' ‚ÇΩ';
document.getElementById('cardNumber').textContent=d.card||'0000 0000 0000 0000';

document.getElementById('auth').classList.add('hidden');
document.getElementById('app').classList.remove('hidden');

loadUsers();
startAutoUpdate();
}

function startAutoUpdate(){

if(autoUpdateInterval) clearInterval(autoUpdateInterval);

autoUpdateInterval=setInterval(async ()=>{
await refreshBalance();
},5000);

}

async function refreshBalance(){

const r=await fetch(API,{
method:'POST',
body:JSON.stringify({action:'balance',email:userEmail})
});

const d=await r.json();

if(d.balance!==undefined){
document.getElementById('balance').textContent=d.balance+' ‚ÇΩ';
}

}

async function loadUsers(){

const to=document.getElementById('to');

to.innerHTML='<option value="">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</option>';

Object.keys(names).filter(e=>e!==userEmail).forEach(e=>{
const o=document.createElement('option');
o.value=e;
o.textContent=names[e];
to.appendChild(o);
});

}

async function transfer(){

const to=document.getElementById('to').value;
const amountVal=Number(document.getElementById('amount').value);

if(!to||amountVal<=0) return;

await fetch(API,{
method:'POST',
body:JSON.stringify({
action:'transfer',
from:userEmail,
to,
amount:amountVal,
comment:document.getElementById('comment').value
})
});

await refreshBalance();

}

function downloadStatement(){
alert('–í—ã–ø–∏—Å–∫–∞ —Å–∫–∞—á–∞–Ω–∞');
}

function logout(){
location.reload();
}
</script>

</body>
</html>
