<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Demo Online Bank</title>

<style>
body{
font-family:Arial;
background:#0f172a;
color:white;
padding:40px;
}

.card{
background:#1e293b;
padding:20px;
border-radius:15px;
margin-bottom:20px;
}

input,button{
padding:10px;
margin:5px;
border-radius:8px;
border:none;
}

button{
background:#22c55e;
color:white;
cursor:pointer;
}

#bank{display:none;}
</style>

</head>
<body>

<h1>ğŸ¦ Demo Online Bank</h1>

<div id="login" class="card">
<h3>Login</h3>
<input id="email" placeholder="email"><br>
<input id="password" type="password" placeholder="password"><br>
<button onclick="login()">Login</button>
</div>

<div id="bank">

<div class="card">
<h3>ğŸ’³ Account</h3>
<p id="info"></p>
<button onclick="refresh()">Refresh balance</button>
<button onclick="logout()">Logout</button>
</div>

<div class="card">
<h3>ğŸ’¸ Transfer</h3>
<input id="to" placeholder="receiver email"><br>
<input id="amount" placeholder="amount"><br>
<button onclick="transfer()">Send</button>
</div>

<div class="card">
<h3>ğŸ“œ History</h3>
<div id="history"></div>
<button onclick="loadHistory()">Load history</button>
</div>

</div>

<script>

const API="https://script.google.com/macros/s/AKfycbw5rnGgWUFlumk3D82maoKeDYfqDQyn-SkKMtAL7BErvZMtXbKZ9Y_QKerYnPYvWEki7g/exec";
let user=null;

window.onload=()=>{
const saved=localStorage.getItem("user");
if(saved){
user=JSON.parse(saved);
showBank();
refresh();
}
}

function showBank(){
login.style.display="none";
bank.style.display="block";
updateInfo();
}

function updateInfo(){
info.innerText=
"User: "+user.email+
" | Balance: "+user.balance;
}

async function login(){

const res=await fetch(API,{
method:"POST",
body:JSON.stringify({
action:"login",
email:email.value,
password:password.value
})
});

const data=await res.json();

if(data.status==="success"){
user=data;
localStorage.setItem("user",JSON.stringify(user));
showBank();
}else{
alert("wrong login");
}
}

async function refresh(){

const res=await fetch(API,{
method:"POST",
body:JSON.stringify({
action:"balance",
email:user.email
})
});

const data=await res.json();
user.balance=data.balance;
localStorage.setItem("user",JSON.stringify(user));
updateInfo();
}

async function transfer(){

const res=await fetch(API,{
method:"POST",
body:JSON.stringify({
action:"transfer",
from:user.email,
to:to.value,
amount:amount.value
})
});

const data=await res.json();

if(data.status==="success"){
user.balance=data.newBalance;
localStorage.setItem("user",JSON.stringify(user));
updateInfo();
alert("sent");
}else{
alert(data.status);
}
}

async function loadHistory(){

const res=await fetch(API,{
method:"POST",
body:JSON.stringify({
action:"history"
})
});

const data=await res.json();

history.innerHTML=data.data
.map(r=>r.join(" | "))
.join("<br>");
}

function logout(){
localStorage.removeItem("user");
location.reload();
}

</script>

</body>
</html>
