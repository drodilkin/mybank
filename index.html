<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>My Bank</title>
</head>
<body>

<h2>Вход</h2>
<input id="email" placeholder="email">
<input id="password" placeholder="password">
<button onclick="login()">Войти</button>

<h3 id="balance"></h3>

<h2>Перевод</h2>
<input id="to" placeholder="email получателя">
<input id="amount" placeholder="сумма">
<button onclick="transfer()">Перевести</button>

<h2>История</h2>
<ul id="history"></ul>

<script>
const API = "https://script.google.com/macros/s/AKfycbxtG3W02IJWB4JwH2oys9zCqoCJxrDP1p3iXPWL1JMhAD8JOHCwr1ofe9Gisqgm3Ehqgg/exec";
let currentEmail = "";

function post(data) {
  return fetch(API, {
    method: "POST",
    body: JSON.stringify(data)
  }).then(r => r.json());
}

function login() {
  post({
    action: "login",
    email: email.value,
    password: password.value
  }).then(r => {
    if (!r.success) return alert("Ошибка входа");
    currentEmail = r.email;
    balance.innerText = "Баланс: " + r.balance;
    loadHistory();
  });
}

function transfer() {
  post({
    action: "transfer",
    from: currentEmail,
    to: to.value,
    amount: Number(amount.value)
  }).then(r => {
    if (r.error) alert(r.error);
    else {
      alert("Перевод выполнен");
      loadHistory();
    }
  });
}

function loadHistory() {
  post({
    action: "history",
    email: currentEmail
  }).then(list => {
    history.innerHTML = "";
    list.forEach(t => {
      let li = document.createElement("li");
      li.innerText = t;
      history.appendChild(li);
    });
  });
}
</script>

</body>
</html>
