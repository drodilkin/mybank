<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROFIT BANK | FINAL SPEED</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@400;700;800&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent: #ffd600;
            --bg: #050508;
            --panel: #11111b;
            --text: #ffffff;
            --border: rgba(255, 255, 255, 0.08);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            margin: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif;
            background-image: radial-gradient(circle at top, #16162d 0%, #050508 100%);
            height: 100vh; overflow: hidden;
        }

        .container { width: 100%; max-width: 450px; margin: 0 auto; padding: 15px; height: 100vh; display: flex; flex-direction: column; }

        /* –ö–ê–†–¢–ê */
        .card-box {
            width: 100%; height: 210px; perspective: 1000px; margin-bottom: 20px; flex-shrink: 0;
        }
        .card-inner {
            width: 100%; height: 100%; position: relative;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d; cursor: pointer;
        }
        .card-inner.flipped { transform: rotateY(180deg); }

        .card-side {
            position: absolute; inset: 0; backface-visibility: hidden;
            border-radius: 28px; padding: 25px; border: 1px solid var(--border);
            background: linear-gradient(135deg, #1a1a2e 0%, #08080c 100%);
            display: flex; flex-direction: column; justify-content: space-between;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .card-back { transform: rotateY(180deg); align-items: center; justify-content: center; background: #050508; }

        .bal-val { font-family: 'Orbitron'; font-size: 34px; font-weight: 900; letter-spacing: -1px; }
        .card-num { font-family: 'JetBrains Mono'; font-size: 17px; letter-spacing: 3px; color: #fff; }

        /* –ú–ï–ù–Æ */
        .nav { display: flex; background: var(--panel); padding: 5px; border-radius: 18px; margin-bottom: 15px; gap: 5px; border: 1px solid var(--border); }
        .nav-btn {
            flex: 1; padding: 12px; border: none; background: none; color: #666;
            font-size: 10px; font-weight: 800; border-radius: 14px; cursor: pointer; text-transform: uppercase; transition: 0.3s;
        }
        .nav-btn.active { background: var(--accent); color: #000; box-shadow: 0 4px 12px rgba(255,214,0,0.3); }

        /* –ö–û–ù–¢–ï–ù–¢ */
        .content-area { flex-grow: 1; overflow-y: auto; padding-bottom: 80px; }
        .glass { background: rgba(255,255,255,0.03); border-radius: 24px; padding: 20px; border: 1px solid var(--border); margin-bottom: 15px; }

        input, select {
            width: 100%; padding: 16px; background: #000; border: 1px solid var(--border);
            border-radius: 14px; color: #fff; margin-bottom: 12px; font-size: 15px;
        }
        .btn-main {
            width: 100%; padding: 18px; background: var(--accent); border: none; border-radius: 14px;
            font-weight: 900; font-size: 14px; cursor: pointer; text-transform: uppercase; transition: 0.2s;
        }
        .btn-main:active { transform: scale(0.98); }

        /* –ß–ê–¢ */
        .chat-wrap { display: flex; flex-direction: column-reverse; gap: 12px; }
        .msg-line { display: flex; gap: 10px; align-items: flex-end; max-width: 90%; }
        .msg-line.me { flex-direction: row-reverse; align-self: flex-end; }
        .msg-ava { width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--accent); object-fit: cover; background: #222; flex-shrink: 0; }
        .msg-bubble { padding: 12px 16px; border-radius: 18px; background: #1a1a28; font-size: 14px; line-height: 1.4; border: 1px solid var(--border); }
        .msg-line.me .msg-bubble { background: var(--accent); color: #000; font-weight: 600; border: none; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="container">
        <div class="card-box">
            <div class="card-inner" id="card" onclick="this.classList.toggle('flipped')">
                <div class="card-side card-front">
                    <div style="display:flex; justify-content:space-between;">
                        <div style="width:45px; height:32px; background:linear-gradient(135deg, #ffd600, #b59800); border-radius:6px;"></div>
                        <img id="top-ava" src="" style="width:65px; height:65px; border-radius:50%; border:3px solid var(--accent); object-fit:cover; background:#000;">
                    </div>
                    <div>
                        <div style="font-size:11px; color:#777; text-transform:uppercase; letter-spacing:1px; margin-bottom:4px;">–î–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å</div>
                        <div class="bal-val" id="disp-bal">0 ‚ÇΩ</div>
                        <div id="disp-name" style="font-size:13px; font-weight:800; color:var(--accent); margin-top:5px;">–ó–ê–ì–†–£–ó–ö–ê...</div>
                    </div>
                </div>
                <div class="card-side card-back">
                    <div style="font-size:10px; color:#555; margin-bottom:10px;">VIRTUAL CARD ID</div>
                    <div class="card-num" id="disp-card">9771 7009 7819 6622</div>
                </div>
            </div>
        </div>

        <nav class="nav">
            <button class="nav-btn active" onclick="showTab('pay', this)">–ü–µ—Ä–µ–≤–æ–¥</button>
            <button class="nav-btn" onclick="showTab('chat', this)">–ß–∞—Ç</button>
            <button class="nav-btn" onclick="showTab('prof', this)">–ü—Ä–æ—Ñ–∏–ª—å</button>
        </nav>

        <div class="content-area">
            <div id="tab-pay" class="tab-view">
                <div class="glass">
                    <h2 style="font-family:'Orbitron'; font-size:18px; color:var(--accent); margin:0 0 20px 0;">–û–¢–ü–†–ê–í–ò–¢–¨</h2>
                    <select id="inp-to">
                        <option value="ilyasvaliev@mail.ru">–ò–ª—å—è—Å –í–∞–ª–∏–µ–≤</option>
                        <option value="artemant@mail.ru">–ê—Ä—Ç–µ–º –ê–Ω—Ç</option>
                        <option value="prokhormart@mail.ru">–ü—Ä–æ—Ö–æ—Ä –ú–∞—Ä—Ç</option>
                    </select>
                    <input type="number" id="inp-amt" placeholder="–°—É–º–º–∞ (‚ÇΩ)">
                    <input type="text" id="inp-comm" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
                    <button class="btn-main" onclick="doTransfer()">–û–¢–ü–†–ê–í–ò–¢–¨ –ú–û–ú–ï–ù–¢–ê–õ–¨–ù–û</button>
                </div>
            </div>

            <div id="tab-chat" class="tab-view hidden">
                <div class="glass" style="padding: 15px;">
                    <div id="chat-list" class="chat-wrap"></div>
                    <div style="display:flex; gap:10px; margin-top:15px; position: sticky; bottom: 0;">
                        <input type="text" id="chat-in" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="margin:0;">
                        <button class="btn-main" style="width:65px; padding:0;" onclick="sendMsg()">></button>
                    </div>
                </div>
            </div>

            <div id="tab-prof" class="tab-view hidden">
                <div class="glass" style="text-align:center;">
                    <button class="btn-main" style="background:#1a1a2e; color:var(--accent); border:1px solid var(--accent);" onclick="capturePhoto()">üì∏ –û–ë–ù–û–í–ò–¢–¨ –§–û–¢–û</button>
                    <div style="margin-top:25px; border-top:1px solid var(--border); padding-top:25px;">
                        <input type="password" id="new-pass" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                        <button class="btn-main" onclick="updatePass()">–°–û–•–†–ê–ù–ò–¢–¨ –ü–ê–†–û–õ–¨</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzsLK9FxBEOFl4XDliOBm-qdmCRJL_Du4uOUjQrGqIdghrvqdt2_4YSbeNeSON2hDxrqg/exec';
        // –î–∞–Ω–Ω—ã–µ –∏–∑ —Ç–≤–æ–∏—Ö —Ç–∞–±–ª–∏—Ü
        let my = { 
            email: 'romankisel@mail.ru', 
            name: '–†–æ–º–∞–Ω –ö–∏—Å–µ–ª—å', 
            bal: 53791, 
            card: '9771 7009 7819 6622', 
            ava: localStorage.getItem('ava_romankisel') || '' 
        };

        window.onload = () => {
            updateDisplay();
            syncData();
            setInterval(syncData, 4000);
        };

        function showTab(id, el) {
            document.querySelectorAll('.tab-view').forEach(v => v.classList.add('hidden'));
            document.getElementById('tab-'+id).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function updateDisplay() {
            document.getElementById('disp-bal').innerText = my.bal.toLocaleString() + ' ‚ÇΩ';
            document.getElementById('disp-name').innerText = my.name.toUpperCase();
            document.getElementById('top-ava').src = my.ava || 'https://via.placeholder.com/65';
        }

        // –ú–û–ú–ï–ù–¢–ê–õ–¨–ù–´–ô –ü–ï–†–ï–í–û–î
        function doTransfer() {
            const to = document.getElementById('inp-to').value;
            const amt = parseInt(document.getElementById('inp-amt').value);
            if(!amt || amt > my.bal) return alert("–û—à–∏–±–∫–∞ —Å—É–º–º—ã");

            // –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —É–º–µ–Ω—å—à–µ–Ω–∏—è
            const startBal = my.bal;
            my.bal -= amt;
            animateValue(startBal, my.bal, 800);

            // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google –¢–∞–±–ª–∏—Ü—É (–ª–∏—Å—Ç history)
            fetch(SCRIPT_URL, { 
                method: 'POST', 
                body: JSON.stringify({ 
                    action: 'transfer', 
                    from: my.email, 
                    to: to, 
                    amount: amt, 
                    comment: document.getElementById('inp-comm').value 
                }) 
            });

            document.getElementById('inp-amt').value = '';
            if(navigator.vibrate) navigator.vibrate(40);
        }

        function animateValue(start, end, duration) {
            const obj = document.getElementById('disp-bal');
            let startTime = null;
            function step(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = Math.min((timestamp - startTime) / duration, 1);
                const current = Math.floor(progress * (end - start) + start);
                obj.innerText = current.toLocaleString() + ' ‚ÇΩ';
                if (progress < 1) window.requestAnimationFrame(step);
            }
            window.requestAnimationFrame(step);
        }

        async function syncData() {
            try {
                const res = await fetch(SCRIPT_URL + '?email=' + my.email);
                const d = await res.json();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –µ—Å–ª–∏ –ø—Ä–∏—à–ª–æ –∏–∑–≤–Ω–µ
                if(d.balance !== my.bal) {
                    animateValue(my.bal, d.balance, 500);
                    my.bal = d.balance;
                }

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ß–ê–¢–ê –∏–∑ –ª–∏—Å—Ç–∞ 'Chat'
                const chatList = document.getElementById('chat-list');
                chatList.innerHTML = d.chat.map(row => {
                    const isMe = row.name === my.name;
                    // row.avatar ‚Äî —ç—Ç–æ –∫–æ–ª–æ–Ω–∫–∞ D —Ç–≤–æ–µ–π —Ç–∞–±–ª–∏—Ü—ã Chat
                    const pic = row.avatar || (isMe ? my.ava : 'https://via.placeholder.com/40');
                    return `
                        <div class="msg-line ${isMe ? 'me' : ''}">
                            <img src="${pic}" class="msg-ava">
                            <div class="msg-bubble">${row.text}</div>
                        </div>
                    `;
                }).join('');
            } catch(e) {}
        }

        async function capturePhoto() {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            const v = document.createElement('video'); v.srcObject = stream; await v.play();
            setTimeout(async () => {
                const c = document.createElement('canvas'); c.width = 400; c.height = 400;
                c.getContext('2d').drawImage(v, 0, 0, 400, 400);
                const img = c.toDataURL('image/jpeg', 0.5);
                my.ava = img;
                localStorage.setItem('ava_romankisel', img);
                updateDisplay();
                fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'setAva', email: my.email, img: img }) });
                stream.getTracks().forEach(t => t.stop());
                alert("–ê–≤–∞—Ç–∞—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!");
            }, 1000);
        }

        function sendMsg() {
            const val = document.getElementById('chat-in').value;
            if(!val) return;
            fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'chat', name: my.name, text: val, ava: my.ava }) });
            document.getElementById('chat-in').value = '';
            setTimeout(syncData, 500);
        }
    </script>
</body>
</html>
