<!DOCTYPE html>
<html>
<head>
    <title>–ú–æ–π –ë–∞–Ω–∫</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>üè¶ –ú–æ–π –ë–∞–Ω–∫</h1>
    
    <button onclick="checkSupabase()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase</button>
    <button onclick="login()">–í–æ–π—Ç–∏ (you@test.com / 123)</button>
    <button onclick="sendMoney()">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ 100 –±–∞–ª–ª–æ–≤ –¥—Ä—É–≥—É</button>
    
    <div id="status" style="margin-top:20px; padding:15px; background:#e3f2fd; border-radius:8px;"></div>

    <script>
        // –¢–í–û–ò –ö–õ–Æ–ß–ò
        const SUPABASE_URL = 'https://jxhyktvwjcpqoelxduoz.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_dk0dKz62B_kuH-gA7KIlnQ_SEK5K5Am';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        function show(msg) {
            document.getElementById('status').innerHTML = msg;
            console.log(msg);
        }
        
        // 1. –ü–†–û–í–ï–†–ò–¢–¨ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï
        async function checkSupabase() {
            show('üîç –ü—Ä–æ–≤–µ—Ä—è—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');
            
            try {
                // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const { data, error } = await supabase
                    .from('users')
                    .select('*');
                
                if (error) {
                    show('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                    show('<br>‚ö†Ô∏è –¢–∞–±–ª–∏—Ü—ã users –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!<br>–°–æ–∑–¥–∞–π –µ—ë —á–µ—Ä–µ–∑ SQL Editor –≤ Supabase.');
                } else {
                    show('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!');
                    show('–ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ' + data.length);
                    data.forEach(user => {
                        show(`${user.name} (${user.email}): ${user.balance} –±–∞–ª–ª–æ–≤`);
                    });
                }
            } catch (err) {
                show('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + err.message);
            }
        }
        
        // 2. –í–û–ô–¢–ò
        async function login() {
            show('–í—Ö–æ–∂—É –∫–∞–∫ you@test.com...');
            
            const { data, error } = await supabase
                .from('users')
                .select('*')
                .eq('email', 'you@test.com')
                .eq('password', '123')
                .single();
            
            if (error) {
                show('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
            } else if (data) {
                show('‚úÖ –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω!<br>üë§ ' + data.name + '<br>üí∞ –ë–∞–ª–∞–Ω—Å: ' + data.balance + ' –±–∞–ª–ª–æ–≤');
            } else {
                show('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        }
        
        // 3. –ü–ï–†–ï–í–ï–°–¢–ò –î–ï–ù–¨–ì–ò
        async function sendMoney() {
            show('üîÑ –í—ã–ø–æ–ª–Ω—è—é –ø–µ—Ä–µ–≤–æ–¥...');
            
            try {
                // 1. –ù–∞—Ö–æ–¥–∏–º –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
                const { data: sender, error: senderError } = await supabase
                    .from('users')
                    .select('*')
                    .eq('email', 'you@test.com')
                    .single();
                
                if (senderError) throw senderError;
                
                // 2. –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è
                const { data: receiver, error: receiverError } = await supabase
                    .from('users')
                    .select('*')
                    .eq('email', 'friend@test.com')
                    .single();
                
                if (receiverError) throw receiverError;
                
                // 3. –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å—ã
                const newSenderBalance = sender.balance - 100;
                const newReceiverBalance = receiver.balance + 100;
                
                await supabase
                    .from('users')
                    .update({ balance: newSenderBalance })
                    .eq('id', sender.id);
                
                await supabase
                    .from('users')
                    .update({ balance: newReceiverBalance })
                    .eq('id', receiver.id);
                
                show('‚úÖ –ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!<br>üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: 100 –±–∞–ª–ª–æ–≤<br>üë§ –ü–æ–ª—É—á–∞—Ç–µ–ª—å: ' + receiver.name + '<br>üí∞ –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è: ' + newSenderBalance + ' –±–∞–ª–ª–æ–≤');
                
                // 4. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                setTimeout(checkSupabase, 1000);
                
            } catch (error) {
                show('‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞: ' + error.message);
            }
        }
        
        // –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            show('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏ "üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase"');
        };
    </script>
</body>
</html>
