<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>PROFIT BANK PLATINUM</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --y: #ffd600; --bg: #050508; --card: #0f0f13; --glass: rgba(255, 255, 255, 0.03); }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            margin:0; background: var(--bg); color:#fff; font-family:'Inter', sans-serif; 
            height: 100vh; overflow: hidden; display: flex; flex-direction: column;
        }

        /* –≠–ö–†–ê–ù –í–•–û–î–ê */
        #authScreen {
            position: fixed; inset: 0; z-index: 1000; background: var(--bg);
            display: flex; align-items: center; justify-content: center; padding: 20px;
            transition: 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #authScreen.hide { opacity: 0; transform: translateY(-100%) scale(1.1); pointer-events: none; }
        
        .login-card {
            width: 100%; max-width: 360px; text-align: center;
            padding: 40px 30px; border-radius: 40px; background: var(--card);
            border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 30px 60px rgba(0,0,0,0.5);
        }
        .logo { font-family:'Orbitron'; font-size: 32px; font-weight: 900; color: var(--y); margin-bottom: 10px; }
        .sub-logo { font-size: 10px; letter-spacing: 3px; color: #444; margin-bottom: 40px; }

        .input-group { position: relative; margin-bottom: 20px; }
        .input-group input {
            width: 100%; padding: 18px 20px; background: #000; border: 1px solid #1a1a1a;
            border-radius: 18px; color: #fff; font-size: 16px; outline: none; transition: 0.3s;
        }
        .input-group input:focus { border-color: var(--y); box-shadow: 0 0 15px rgba(255,214,0,0.1); }

        .btn-main {
            width: 100%; padding: 20px; background: var(--y); border: none; border-radius: 18px;
            font-family: 'Orbitron'; font-weight: 900; font-size: 14px; cursor: pointer; transition: 0.3s;
        }
        .btn-main:active { transform: scale(0.97); }

        /* –ì–õ–ê–í–ù–´–ô –ò–ù–¢–ï–†–§–ï–ô–° */
        .app-container { flex: 1; display: flex; flex-direction: column; padding: 20px; padding-bottom: 90px; overflow-y: auto; }
        
        .balance-card {
            background: linear-gradient(135deg, #1a1a24 0%, #08080c 100%);
            padding: 30px; border-radius: 35px; border: 1px solid rgba(255,255,255,0.08);
            margin-bottom: 20px; position: relative; overflow: hidden;
        }
        .bal-label { font-size: 11px; color: #555; letter-spacing: 2px; font-weight: 800; }
        .bal-val { font-family: 'Orbitron'; font-size: 42px; font-weight: 900; margin: 10px 0; transition: 0.5s; }
        .card-num { font-family: 'Orbitron'; font-size: 12px; color: var(--y); opacity: 0.7; }

        /* –í–ö–õ–ê–î–ö–ò */
        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* –ò–°–¢–û–†–ò–Ø */
        .hist-item {
            background: var(--glass); padding: 18px; border-radius: 22px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center;
            border: 1px solid rgba(255,255,255,0.03);
        }
        .hist-info div:first-child { font-weight: 700; font-size: 14px; margin-bottom: 4px; }
        .hist-info div:last-child { font-size: 11px; color: #444; }
        .amt { font-family: 'Orbitron'; font-weight: 900; font-size: 15px; }
        .amt.plus { color: #00ffaa; }
        .amt.minus { color: #ff3366; }

        /* NFC –ü–ê–ù–ï–õ–¨ */
        .nfc-hub { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .nfc-btn {
            background: var(--card); padding: 25px 15px; border-radius: 25px;
            text-align: center; border: 1px solid #1a1a1a; transition: 0.3s;
        }
        .nfc-btn:active { background: #1a1a24; }
        .nfc-btn i { font-size: 28px; display: block; margin-bottom: 10px; }
        .nfc-btn span { font-size: 10px; font-weight: 800; color: #666; text-transform: uppercase; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav-bar {
            position: fixed; bottom: 20px; left: 20px; right: 20px;
            background: rgba(15, 15, 20, 0.8); backdrop-filter: blur(20px);
            border-radius: 25px; display: flex; padding: 10px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .nav-item {
            flex: 1; padding: 15px; border: none; background: transparent;
            color: #444; font-weight: 800; font-size: 10px; transition: 0.3s;
        }
        .nav-item.active { color: var(--y); }

        .hidden { display: none; }
        .status-msg { font-size: 12px; color: var(--y); text-align: center; margin-top: 15px; height: 20px; }
    </style>
</head>
<body>

<div id="authScreen">
    <div class="login-card">
        <div class="logo">PROFIT</div>
        <div class="sub-logo">PLATINUM CORE</div>
        <div class="input-group">
            <input type="email" id="login-email" placeholder="Email –∞–¥—Ä–µ—Å">
        </div>
        <div class="input-group">
            <input type="password" id="login-pass" placeholder="–ü–∞—Ä–æ–ª—å">
        </div>
        <button class="btn-main" onclick="handleLogin()">–ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø</button>
    </div>
</div>

<div class="app-container">
    <div class="balance-card">
        <div class="bal-label">–¢–ï–ö–£–©–ò–ô –ë–ê–õ–ê–ù–°</div>
        <div id="main-bal" class="bal-val">0 ‚ÇΩ</div>
        <div id="main-card" class="card-num">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
    </div>

    <div id="view-home" class="tab-content active">
        <h3 style="font-size:12px; color:#333; letter-spacing:2px; margin-bottom:20px;">–ò–°–¢–û–†–ò–Ø –û–ü–ï–†–ê–¶–ò–ô</h3>
        <div id="history-list"></div>
    </div>

    <div id="view-send" class="tab-content">
        <div class="login-card" style="box-shadow:none; padding:0; background:transparent;">
            <h3 class="bal-label" style="margin-bottom:20px;">–û–¢–ü–†–ê–í–ò–¢–¨ –ü–û EMAIL</h3>
            <div class="input-group">
                <input type="email" id="send-to" placeholder="–ö–æ–º—É (email)">
            </div>
            <div class="input-group">
                <input type="number" id="send-amt" placeholder="–°—É–º–º–∞ ‚ÇΩ">
            </div>
            <button class="btn-main" onclick="sendTransfer()">–ü–û–î–¢–í–ï–†–î–ò–¢–¨</button>
        </div>
    </div>

    <div id="view-nfc" class="tab-content">
        <div class="nfc-hub">
            <div class="nfc-btn" onclick="nfcPay()"><i>üí∏</i><span>–ü—Ä–∏–Ω—è—Ç—å –æ–ø–ª–∞—Ç—É</span></div>
            <div class="nfc-btn" onclick="nfcBind()"><i>üîó</i><span>–ü—Ä–∏–≤—è–∑–∞—Ç—å —Ç–µ–≥</span></div>
        </div>
        <div id="nfc-status" class="status-msg"></div>
    </div>
</div>

<div class="nav-bar">
    <button class="nav-item active" onclick="switchTab('home', this)">–ì–õ–ê–í–ù–ê–Ø</button>
    <button class="nav-item" onclick="switchTab('send', this)">–ü–ï–†–ï–í–û–î</button>
    <button class="nav-item" onclick="switchTab('nfc', this)">NFC</button>
</div>

<script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbyEN5Dhe5Y6lHCVrj_giKoCy2MKrRXa0_SuCRGQRqT6CKWa_g2QJc_fIUTrL15_Pw36QQ/exec';
    let user = null;

    async function handleLogin() {
        const email = document.getElementById('login-email').value;
        const pass = document.getElementById('login-pass').value;
        
        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'login', email, pass })});
            const d = await res.json();
            if (d.success) {
                user = { email, ...d };
                document.getElementById('authScreen').classList.add('hide');
                document.getElementById('main-card').innerText = d.card;
                sync();
                setInterval(sync, 5000);
            } else alert("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω");
        } catch (e) { alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏"); }
    }

    async function sync() {
        const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'sync', email: user.email })});
        const d = await res.json();
        
        // –ö—Ä–∞—Å–∏–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        document.getElementById('main-bal').innerText = d.bal.toLocaleString() + ' ‚ÇΩ';
        
        // –†–µ–Ω–¥–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
        const hList = document.getElementById('history-list');
        hList.innerHTML = d.history.map(h => {
            const isOut = h[1].toLowerCase() === user.email.toLowerCase();
            return `
                <div class="hist-item">
                    <div class="hist-info">
                        <div>${isOut ? '–ü–µ—Ä–µ–≤–æ–¥: ' + h[2] : '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç: ' + h[1]}</div>
                        <div>${h[4] || 'PROFIT Transaction'}</div>
                    </div>
                    <div class="amt ${isOut ? 'minus' : 'plus'}">
                        ${isOut ? '-' : '+'}${h[3]}
                    </div>
                </div>
            `;
        }).join('');
    }

    async function sendTransfer() {
        const to = document.getElementById('send-to').value;
        const amt = document.getElementById('send-amt').value;
        if (!to || !amt) return;

        const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ 
            action: 'transfer', from: user.email, to, amount: amt 
        })});
        const d = await res.json();
        if (d.success) {
            alert("–ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!");
            switchTab('home', document.querySelector('.nav-item'));
            sync();
        } else alert(d.msg || "–û—à–∏–±–∫–∞");
    }

    async function nfcPay() {
        if (!('NDEFReader' in window)) return alert("NFC –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è");
        const status = document.getElementById('nfc-status');
        status.innerText = "–ü–û–î–ù–ï–°–ò–¢–ï –ß–£–ñ–£–Æ –ú–ï–¢–ö–£...";
        
        try {
            const ndef = new NDEFReader();
            await ndef.scan();
            ndef.onreading = async ({ serialNumber }) => {
                const amt = prompt("–°—É–º–º–∞ –∫ —Å–ø–∏—Å–∞–Ω–∏—é?");
                if (!amt) return;
                const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({
                    action: 'nfc_pay', tagId: serialNumber, myEmail: user.email, amount: amt
                })});
                const d = await res.json();
                status.innerText = d.success ? "–û–ü–õ–ê–¢–ê –ü–†–ò–ù–Ø–¢–ê!" : d.msg;
                sync();
            };
        } catch (e) { status.innerText = "–û–®–ò–ë–ö–ê NFC"; }
    }

    async function nfcBind() {
        if (!('NDEFReader' in window)) return alert("NFC –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è");
        const status = document.getElementById('nfc-status');
        status.innerText = "–ü–†–ò–õ–û–ñ–ò–¢–ï –í–ê–®–£ –ú–ï–¢–ö–£...";
        
        try {
            const ndef = new NDEFReader();
            await ndef.scan();
            ndef.onreading = async ({ serialNumber }) => {
                await fetch(API_URL, { method: 'POST', body: JSON.stringify({
                    action: 'bind_nfc', email: user.email, tagId: serialNumber
                })});
                status.innerText = "–ú–ï–¢–ö–ê –ü–†–ò–í–Ø–ó–ê–ù–ê –ö –í–ê–ú!";
            };
        } catch (e) { status.innerText = "–û–®–ò–ë–ö–ê"; }
    }

    function switchTab(tab, btn) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.getElementById('view-' + tab).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }
</script>
</body>
</html>
