<!DOCTYPE html>
<html lang="ru">  
<head>  
<meta charset="UTF-8">  
<title>Profit Bank Premium</title>  
<meta name="viewport" content="width=device-width, initial-scale=1.0">  
<style>  
:root{  
    --bg: #050508;  
    --card: #12121a;  
    --input: #1c1c27;  
    --accent: #ffd600;  
    --accent-glow: rgba(255, 214, 0, 0.3);
    --text: #ffffff;  
    --muted: #8e8e9a;  
    --success: #00ff88;
    --error: #ff3d71;
    --glass: rgba(255, 255, 255, 0.03);
}  
  
*{box-sizing:border-box; font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;}  
  
body{  
    margin: 0;  
    background: var(--bg);  
    background-image: radial-gradient(circle at 50% -20%, #1a1a2e 0%, #050508 100%);
    color: var(--text);  
    min-height: 100vh;  
    display: flex;  
    justify-content: center;  
    align-items: center;  
}  
  
.hidden{display:none !important;}  

/* --- –°–¢–ò–õ–¨ –í–•–û–î–ê --- */
.auth {
    background: var(--card);
    padding: 40px 30px;
    border-radius: 28px;
    width: 100%;
    max-width: 360px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    border: 1px solid rgba(255,255,255,0.05);
    text-align: center;
}

.auth h1 {
    margin: 0 0 10px 0;
    font-size: 28px;
    letter-spacing: -1px;
    background: linear-gradient(to right, #fff, #ffd600);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.auth p { color: var(--muted); margin-bottom: 25px; font-size: 14px; }

.auth input {
    width: 100%;
    margin-top: 12px;
    padding: 16px;
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 16px;
    background: var(--input);
    color: white;
    outline: none;
    transition: 0.3s;
}

.auth input:focus { border-color: var(--accent); box-shadow: 0 0 10px var(--accent-glow); }

.auth button {
    width: 100%;
    margin-top: 24px;
    padding: 16px;
    border: none;
    border-radius: 16px;
    background: var(--accent);
    color: #000;
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
}

.auth button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px var(--accent-glow); }

/* --- –û–°–ù–û–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï --- */
.app { width: 100%; max-width: 420px; padding: 20px; }

/* --- –î–ò–ó–ê–ô–ù –ö–ê–†–¢–´ --- */
.card-wrap { perspective: 1000px; margin-bottom: 25px; }

.card {
    width: 100%;
    height: 210px;
    border-radius: 24px;
    transition: 0.7s cubic-bezier(0.4, 0, 0.2, 1);
    transform-style: preserve-3d;
    cursor: pointer;
    position: relative;
    box-shadow: 0 15px 35px rgba(0,0,0,0.5);
}

.card.flipped { transform: rotateY(180deg); }

.card-face {
    position: absolute;
    inset: 0;
    padding: 25px;
    backface-visibility: hidden;
    border-radius: 24px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.1);
}

.card-front {
    background: linear-gradient(135deg, #1e1e2e 0%, #111118 100%);
}

.chip {
    width: 45px; height: 34px;
    background: linear-gradient(135deg, #fceabb 0%, #fccd4d 50%, #f8b500 100%);
    border-radius: 6px;
    margin-bottom: 20px;
    position: relative;
}

.balance-title { color: var(--muted); font-size: 14px; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px;}
.balance-amount { font-size: 38px; font-weight: 800; letter-spacing: -1px; text-shadow: 0 0 15px rgba(255,255,255,0.1); }

.card-back {
    background: linear-gradient(135deg, #111118 0%, #1e1e2e 100%);
    transform: rotateY(180deg);
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.mag-stripe {
    position: absolute; top: 30px; left: 0;
    width: 100%; height: 45px; background: #000;
}

.card-number-label { color: var(--muted); font-size: 12px; margin-bottom: 8px; }
.card-number-val { 
    font-size: 22px; 
    letter-spacing: 3px; 
    font-family: 'Courier New', monospace; 
    background: rgba(255,255,255,0.05);
    padding: 10px;
    border-radius: 8px;
    text-align: center;
}

/* --- –¢–ê–ë–´ --- */
.tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
.tabs button {
    flex: 1 1 45%; padding: 10px; border-radius: 12px; border: none;
    background: var(--glass); color: var(--muted); cursor: pointer; transition: 0.3s;
    font-size: 13px;
}
.tabs button.active { background: var(--accent); color: #000; font-weight: 600; }

/* --- –ë–õ–û–ö–ò --- */
.block { background: var(--card); border-radius: 22px; padding: 20px; margin-top: 15px; border: 1px solid rgba(255,255,255,0.03); }
.block h3 { margin: 0 0 15px 0; font-size: 17px; }

.block input, .block select, .block button {
    width: 100%; margin-top: 10px; padding: 14px; border: none; border-radius: 14px; outline: none;
}
.block input, .block select { background: var(--input); color: white; border: 1px solid transparent; }
.block input:focus { border-color: var(--accent); }
.block button { background: var(--accent); font-weight: 700; cursor: pointer; transition: 0.3s; }

/* --- –ò–°–¢–û–†–ò–Ø --- */
.history-item {
    background: var(--glass); padding: 16px; border-radius: 18px; margin-bottom: 12px;
    border-left: 4px solid transparent;
}
.history-item.in { border-left-color: var(--success); }
.history-item.out { border-left-color: var(--error); }

.hist-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
.hist-sum { font-weight: 700; }
.hist-comm { 
    background: rgba(255,255,255,0.05); padding: 6px 12px; border-radius: 10px; 
    font-size: 13px; color: var(--muted); margin: 8px 0; display: inline-block;
}
.hist-date { font-size: 11px; color: var(--muted); display: block; }

.logout { background: transparent !important; color: var(--error) !important; border: 1px solid rgba(255,61,113,0.2) !important; margin-top: 30px;}
</style>
</head>
<body>

<div class="auth" id="auth">
    <h1>Profit Bank</h1>
    <p>–î–æ—Å—Ç—É–ø –∫ –≤–∞—à–∏–º –∞–∫—Ç–∏–≤–∞–º</p>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <button onclick="login()">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</button>
</div>

<div class="app hidden" id="app">
    <div class="card-wrap">
        <div class="card" id="bankCard" onclick="flipCard()">
            <div class="card-face card-front">
                <div class="chip"></div>
                <div class="balance-title">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
                <div class="balance-amount" id="balance">0 ‚ÇΩ</div>
                <div style="position:absolute; bottom:25px; right:25px; opacity:0.3; font-weight:bold; font-style:italic">PROFIT</div>
            </div>
            <div class="card-face card-back">
                <div class="mag-stripe"></div>
                <div class="card-number-label">–ù–û–ú–ï–† –ö–ê–†–¢–´</div>
                <div class="card-number-val" id="cardNumber">0000 0000 0000 0000</div>
                <div style="margin-top:20px; font-size:10px; color:var(--muted)">PROFIT BANK PLATINUM</div>
            </div>
        </div>
    </div>

    <div class="tabs">
        <button onclick="openTab('transferTab',this)" class="active">–ü–µ—Ä–µ–≤–æ–¥—ã</button>
        <button onclick="openTab('nfcTab',this)">NFC</button>
        <button onclick="openTab('historyTab',this)">–ò—Å—Ç–æ—Ä–∏—è</button>
        <button onclick="openTab('profileTab',this)">–ü—Ä–æ—Ñ–∏–ª—å</button>
    </div>

    <div id="transferTab">
        <div class="block">
            <h3>–ù–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥</h3>
            <select id="to"></select>
            <input id="amount" type="number" placeholder="–°—É–º–º–∞ ‚ÇΩ">
            <input id="comment" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—é">
            <button onclick="transfer()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–µ–Ω—å–≥–∏</button>
        </div>
    </div>

    <div id="nfcTab" class="hidden">
        <div class="block" style="text-align:center">
            <h3>NFC –ú–æ–¥—É–ª—å</h3>
            <div style="font-size:50px; margin:20px 0">üì°</div>
            <button onclick="startNFC()">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É</button>
            <div id="nfcStatus" style="margin-top:15px; color:var(--muted); font-size:14px"></div>
        </div>
    </div>

    <div id="historyTab" class="hidden">
        <div class="block" style="background:transparent; padding:0; border:none">
            <button onclick="downloadStatement()" style="background:var(--input); color:white; border: 1px solid rgba(255,255,255,0.05)">üì• –°–∫–∞—á–∞—Ç—å –≤—ã–ø–∏—Å–∫—É (.txt)</button>
        </div>
        <div id="history"></div>
    </div>

    <div id="profileTab" class="hidden">
        <div class="block">
            <h3>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
            <p style="font-size:12px; color:var(--muted)">–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å –æ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞ Profit Bank.</p>
            <input id="newPassword" type="password" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
            <input id="confirmPassword" type="password" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            <button onclick="changePassword()" style="background:#fff; color:#000">–û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
            <div id="passwordStatus" style="margin-top:10px; font-size:13px; text-align:center"></div>
        </div>
    </div>

    <button class="block logout" onclick="logout()">–í—ã–π—Ç–∏ –∏–∑ Profit Bank</button>
</div>

<script>
const API='https://script.google.com/macros/s/AKfycbxWai26u9z1v6yEJ2A06xTuCRQbn6X3yMPhoeKvuz-GHGMQTYl_OPElLGR3bZ-HQlTcXg/exec';

let userEmail='';
let lastTxCount=0;
let lastHistory=[];
let autoUpdateInterval=null;

const names={
    'ilyasvaliev@mail.ru':'–ò–ª—å—è—Å',
    'prokhormart@mail.ru':'–ü—Ä–æ—Ö–æ—Ä',
    'romankisel@mail.ru':'–†–æ–º–∞–Ω',
    'artemant@mail.ru':'–ê—Ä—Ç–µ–º'
};

function getName(e){return names[e]||e;}
function flipCard(){ document.getElementById('bankCard').classList.toggle('flipped'); }

function openTab(id,btn){
    document.querySelectorAll('#transferTab,#nfcTab,#historyTab,#profileTab').forEach(e=>e.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
}

async function login(){
    const email=document.getElementById('email').value.trim();
    const password=document.getElementById('password').value.trim();
    if(!email || !password) return alert('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ');

    const r=await fetch(API,{method:'POST',body:JSON.stringify({action:'login',email,password})});
    const d=await r.json();

    if(!d.success) return alert('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');

    userEmail=email;
    document.getElementById('balance').textContent=d.balance+' ‚ÇΩ';
    document.getElementById('cardNumber').textContent=d.card || '4400 1234 5678 9000';
    
    document.getElementById('auth').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');

    loadUsers();
    loadHistory();
    startAutoUpdate();
}

async function changePassword(){
    const newPass = document.getElementById('newPassword').value;
    const confirmPass = document.getElementById('confirmPassword').value;
    const status = document.getElementById('passwordStatus');

    if(newPass.length < 4) {
        status.textContent = "–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π";
        status.style.color = "var(--error)";
        return;
    }
    if(newPass !== confirmPass) {
        status.textContent = "–ü–∞—Ä–æ–ª—å –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç";
        status.style.color = "var(--error)";
        return;
    }

    status.textContent = "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...";
    status.style.color = "var(--accent)";

    try {
        const r = await fetch(API, {
            method: 'POST',
            body: JSON.stringify({
                action: 'changePassword',
                email: userEmail,
                newPassword: newPass
            })
        });
        const d = await r.json();
        if(d.success) {
            status.textContent = "–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!";
            status.style.color = "var(--success)";
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        } else {
            status.textContent = "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞";
            status.style.color = "var(--error)";
        }
    } catch(e) {
        status.textContent = "–ù–µ—Ç —Å–≤—è–∑–∏ —Å –±–∞–Ω–∫–æ–º";
        status.style.color = "var(--error)";
    }
}

async function transfer(){
    const toUser=document.getElementById('to').value;
    const amountVal=Number(document.getElementById('amount').value);
    const commentVal=document.getElementById('comment').value;

    if(!toUser || amountVal<=0) return alert('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É–º–º—É');

    document.getElementById('amount').value='';
    document.getElementById('comment').value='';

    await fetch(API,{
        method:'POST',
        body:JSON.stringify({
            action:'transfer',
            from:userEmail,
            to:toUser,
            amount:amountVal,
            comment:commentVal
        })
    });
    
    loadHistory();
    refreshBalance();
}

async function loadHistory(){
    const r=await fetch(API,{method:'POST',body:JSON.stringify({action:'history',email:userEmail})});
    const d=await r.json();
    const newHistory=d.history||[];

    if(lastTxCount!==0 && newHistory.length > lastTxCount){
        const last = newHistory[0];
        const pushTitle = last[1] === userEmail ? "üí∏ Profit Bank: –°–ø–∏—Å–∞–Ω–∏–µ" : "üí∞ Profit Bank: –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ";
        if(Notification.permission==="granted") new Notification(pushTitle, {body: `${last[3]} ‚ÇΩ`});
    }
    
    lastTxCount = newHistory.length;
    lastHistory = newHistory;
    const container = document.getElementById('history');
    container.innerHTML = '<h3 style="margin: 20px 0 10px 10px">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>';

    newHistory.forEach(h => {
        const [date, from, to, sum, comm] = h;
        const type = from === userEmail ? 'out' : 'in';
        const partner = type === 'out' ? getName(to) : getName(from);
        
        const div = document.createElement('div');
        div.className = `history-item ${type}`;
        div.innerHTML = `
            <div class="hist-top">
                <span class="hist-name">${partner}</span>
                <span class="hist-sum" style="color:var(--${type==='out'?'error':'success'})">
                    ${type==='out'?'-':'+'}${sum} ‚ÇΩ
                </span>
            </div>
            ${comm ? `<div class="hist-comm">üí¨ ${comm}</div>` : ''}
            <span class="hist-date">${new Date(date).toLocaleString()}</span>
        `;
        container.appendChild(div);
    });
}

async function refreshBalance(){
    const r=await fetch(API,{method:'POST',body:JSON.stringify({action:'balance',email:userEmail})});
    const d=await r.json();
    if(d.balance!==undefined) document.getElementById('balance').textContent=d.balance+' ‚ÇΩ';
}

function startAutoUpdate(){
    if(autoUpdateInterval) clearInterval(autoUpdateInterval);
    autoUpdateInterval = setInterval(() => {
        refreshBalance();
        loadHistory();
    }, 5000);
}

async function loadUsers(){
    const select = document.getElementById('to');
    select.innerHTML = '<option value="">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</option>';
    Object.keys(names).filter(e => e !== userEmail).forEach(e => {
        const opt = document.createElement('option');
        opt.value = e;
        opt.textContent = names[e];
        select.appendChild(opt);
    });
}

function downloadStatement(){
    let txt = "PROFIT BANK STATEMENT\n================\n";
    lastHistory.forEach(h => {
        txt += `${new Date(h[0]).toLocaleString()} | ${h[1]===userEmail?'-':'+'}${h[3]} ‚ÇΩ | ${h[4]||''}\n`;
    });
    const blob = new Blob([txt], {type:'text/plain'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'profit_bank_statement.txt';
    a.click();
}

async function startNFC(){
    const status=document.getElementById('nfcStatus');
    if(!('NDEFReader' in window)) return status.textContent='NFC –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
    try {
        const reader = new NDEFReader();
        await reader.scan();
        status.textContent = 'üì° –ü–æ–¥–Ω–µ—Å–∏—Ç–µ –∫–∞—Ä—Ç—É Profit Bank...';
        reader.onreading = () => { status.textContent = '‚úÖ –ö–∞—Ä—Ç–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞!'; };
    } catch(err) { status.textContent = '–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ NFC'; }
}

function logout(){ location.reload(); }
</script>
</body>
</html>
