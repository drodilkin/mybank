<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>üè¶ –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ë–∞–Ω–∫</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #667eea, #764ba2);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

.container {
  background: white;
  padding: 30px;
  border-radius: 12px;
  width: 100%;
  max-width: 400px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

h1, h3 {
  text-align: center;
}

input, select, button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  font-size: 16px;
}

button {
  background: #667eea;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

button:hover {
  background: #5a6fe0;
}

.balance {
  font-size: 28px;
  text-align: center;
  margin: 20px 0;
  color: #28a745;
}

.message {
  margin-top: 10px;
  padding: 10px;
  text-align: center;
  border-radius: 6px;
}

.success { background: #d4edda; color: #155724; }
.error { background: #f8d7da; color: #721c24; }
</style>
</head>

<body>

<div class="container">

  <!-- LOGIN -->
  <div id="loginScreen">
    <h1>üè¶ –ë–∞–Ω–∫</h1>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <button onclick="login()">–í–æ–π—Ç–∏</button>
    <div id="loginMsg" class="message"></div>
  </div>

  <!-- BANK -->
  <div id="bankScreen" style="display:none">
    <h3 id="userEmail"></h3>
    <div class="balance" id="balance">0 ‚Çø</div>

    <select id="toUser">
      <option value="">–ü–æ–ª—É—á–∞—Ç–µ–ª—å (email)</option>
      <option value="tilyas@mail.ru">tilyas@mail.ru</option>
      <option value="prokhor@mail.ru">prokhor@mail.ru</option>
      <option value="roma@mail.ru">roma@mail.ru</option>
      <option value="artem@mail.ru">artem@mail.ru</option>
      <option value="test@mail.ru">test@mail.ru</option>
    </select>

    <input id="amount" type="number" placeholder="–°—É–º–º–∞">

    <button onclick="transfer()">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
    <button onclick="logout()" style="background:#dc3545">–í—ã–π—Ç–∏</button>

    <div id="bankMsg" class="message"></div>
  </div>

</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbzBRaaGfxEBHQL16nxPR_Y3dbG2nTF_Q8ui0XMyJ_DCFmHuuFovzlI1bO3wT8iE1SHs-w/exec';

let currentUser = null;

// ===== LOGIN =====
async function login() {
  const email = document.getElementById('email').value.toLowerCase().trim();
  const password = document.getElementById('password').value.trim();

  const res = await fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({
      action: 'login',
      email,
      password
    })
  });

  const data = await res.json();

  if (!data.success) {
    show('loginMsg', '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
    return;
  }

  currentUser = data.email;

  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('bankScreen').style.display = 'block';
  document.getElementById('userEmail').textContent = data.email;
  document.getElementById('balance').textContent = data.balance + ' ‚Çø';
}

// ===== TRANSFER =====
async function transfer() {
  const to = document.getElementById('toUser').value;
  const amount = Number(document.getElementById('amount').value);

  if (!to || amount <= 0) {
    show('bankMsg', '‚ùå –ü—Ä–æ–≤–µ—Ä—å –¥–∞–Ω–Ω—ã–µ', 'error');
    return;
  }

  const res = await fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({
      action: 'transfer',
      from: currentUser,
      to,
      amount
    })
  });

  const data = await res.json();

  if (!data.success) {
    show('bankMsg', '‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞', 'error');
    return;
  }

  show('bankMsg', '‚úÖ –ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
  setTimeout(() => location.reload(), 1000);
}

// ===== LOGOUT =====
function logout() {
  location.reload();
}

// ===== MESSAGE =====
function show(id, text, type) {
  const el = document.getElementById(id);
  el.textContent = text;
  el.className = 'message ' + type;
}
</script>

</body>
</html>
