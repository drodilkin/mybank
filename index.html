<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè¶ –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ë–∞–Ω–∫</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { 
            max-width: 500px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 { color: #333; margin-bottom: 30px; text-align: center; }
        .tab-container { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 5px; }
        .tab { 
            padding: 10px 15px; 
            cursor: pointer; 
            background: #f0f0f0;
            border-radius: 5px;
            flex: 1;
            text-align: center;
            min-width: 80px;
        }
        .tab.active { background: #667eea; color: white; font-weight: bold; }
        .tab-content { 
            display: none; 
            padding: 20px; 
            border: 1px solid #f0f0f0;
            border-radius: 5px;
            margin-top: 10px;
        }
        .tab-content.active { display: block; }
        input { 
            width: 100%; 
            padding: 12px; 
            margin: 10px 0; 
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        button { 
            width: 100%; 
            padding: 14px; 
            background: linear-gradient(to right, #667eea, #764ba2);
            color: white; 
            border: none; 
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover { opacity: 0.9; }
        button.logout { background: #dc3545; }
        .balance { 
            font-size: 32px; 
            text-align: center; 
            margin: 20px 0;
            color: #28a745;
            font-weight: bold;
        }
        .message { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            text-align: center;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .transaction { 
            padding: 10px; 
            border-bottom: 1px solid #eee; 
            margin: 5px 0;
        }
        .quick-transfer { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            margin: 15px 0;
        }
        .quick-transfer button { 
            padding: 10px; 
            font-size: 14px; 
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¶ –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ë–∞–Ω–∫</h1>
        
        <div class="tab-container">
            <div class="tab active" onclick="showTab('login')" id="loginTab">–í—Ö–æ–¥</div>
            <div class="tab" onclick="showTab('bank')" id="bankTab" style="display:none">–ú–æ–π —Å—á—ë—Ç</div>
            <div class="tab" onclick="showTab('transfer')" id="transferTab" style="display:none">–ü–µ—Ä–µ–≤–æ–¥</div>
            <div class="tab" onclick="showTab('history')" id="historyTab" style="display:none">–ò—Å—Ç–æ—Ä–∏—è</div>
            <div class="tab" onclick="showTab('users')" id="usersTab" style="display:none">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
        </div>
        
        <!-- –í—Ö–æ–¥ -->
        <div class="tab-content active" id="login">
            <h3>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h3>
            <input type="email" id="loginEmail" placeholder="–í–∞—à email" value="tilyas@mail.ru">
            <input type="password" id="loginPassword" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" value="80223">
            <button onclick="login()">–í–æ–π—Ç–∏ –≤ –±–∞–Ω–∫</button>
            
            <div class="message info">
                <strong>–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</strong><br>
                ‚Ä¢ tilyas@mail.ru / 80223<br>
                ‚Ä¢ Prokhor@mail.ru / 71601<br>
                ‚Ä¢ Roma@mail.ru / 23312<br>
                ‚Ä¢ Artem@mail.ru / 94331
            </div>
            
            <div id="loginMessage" class="message"></div>
        </div>
        
        <!-- –ú–æ–π —Å—á—ë—Ç -->
        <div class="tab-content" id="bank">
            <h3>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>!</h3>
            <div class="balance">–í–∞—à –±–∞–ª–∞–Ω—Å: <span id="balanceAmount">0</span> ‚Çø</div>
            
            <div class="quick-transfer">
                <button onclick="quickTransfer('Prokhor@mail.ru', 100)" style="background:#28a745">–ü–µ—Ä–µ–≤–æ–¥ 100‚Çø –ü—Äo—Ö–æ—Ä—É</button>
                <button onclick="quickTransfer('Roma@mail.ru', 100)" style="background:#28a745">–ü–µ—Ä–µ–≤–æ–¥ 100‚Çø –†–æ–º–µ</button>
                <button onclick="quickTransfer('Artem@mail.ru', 100)" style="background:#28a745">–ü–µ—Ä–µ–≤–æ–¥ 100‚Çø –ê—Ä—Ç—ë–º—É</button>
                <button onclick="quickTransfer('tilyas@mail.ru', 100)" style="background:#ffc107">–ü–µ—Ä–µ–≤–æ–¥ 100‚Çø –°–µ–±–µ</button>
            </div>
            
            <button onclick="showTab('transfer')">–°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥</button>
            <button onclick="showTab('users')">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            <button onclick="logout()" class="logout">–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã</button>
            
            <div id="bankMessage" class="message"></div>
        </div>
        
        <!-- –ü–µ—Ä–µ–≤–æ–¥ -->
        <div class="tab-content" id="transfer">
            <h3>üí∏ –ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3>
            <div class="balance" id="transferBalance">–ë–∞–ª–∞–Ω—Å: 0 ‚Çø</div>
            
            <input type="email" id="toEmail" placeholder="Email –ø–æ–ª—É—á–∞—Ç–µ–ª—è">
            <input type="number" id="amount" placeholder="–°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞" min="1">
            
            <button onclick="makeTransfer()">–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥</button>
            <button onclick="showTab('bank')">–ù–∞–∑–∞–¥</button>
            
            <div id="transferMessage" class="message"></div>
        </div>
        
        <!-- –ò—Å—Ç–æ—Ä–∏—è -->
        <div class="tab-content" id="history">
            <h3>üìä –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
            <button onclick="loadHistory()">–û–±–Ω–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
            <button onclick="showTab('bank')">–ù–∞–∑–∞–¥</button>
            
            <div id="historyList" style="margin-top:15px; max-height:300px; overflow-y:auto;"></div>
        </div>
        
        <!-- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
        <div class="tab-content" id="users">
            <h3>üë• –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–∞–Ω–∫–∞</h3>
            <button onclick="loadAllUsers()">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
            <button onclick="showTab('bank')">–ù–∞–∑–∞–¥</button>
            
            <div id="usersList" style="margin-top:15px;"></div>
        </div>
    </div>

    <script>
        // –í–ê–®–ò –î–ê–ù–ù–´–ï
        const SHEET_ID = '1UJzb281UvBZIGr9rE8y0hzvhHUt_G2YDnRYqlTi03xI'; // –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        const SHEET_ID_2 = '1hoFOCTZjJXq-z3vQmWNWJuNz-I0IR18k7U1jCgTKucE'; // –í—Ç–æ—Ä–∞—è —Ç–∞–±–ª–∏—Ü–∞
        const API_KEY = 'AIzaSyDv5GBoJW60bPwuGOroiVF1r9WokT4zQX0';
        
        let currentUser = null;
        let allUsers = [];
        let transactions = [];
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤–∫–ª–∞–¥–∫—É
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
            if (tabName === 'bank' && currentUser) {
                updateBankDisplay();
            } else if (tabName === 'transfer' && currentUser) {
                updateTransferDisplay();
            } else if (tabName === 'history') {
                loadHistory();
            } else if (tabName === 'users') {
                loadAllUsers();
            }
        }
        
        // –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
        async function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showMessage('loginMessage', '–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å', 'error');
                return;
            }
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                await loadUsers();
                
                // –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = allUsers.find(u => 
                    u.Email && u.Email.trim().toLowerCase() === email.toLowerCase() && 
                    u.Password === password
                );
                
                if (user) {
                    currentUser = {
                        id: user.ID,
                        email: user.Email,
                        password: user.Password,
                        balance: parseInt(user.Balance) || 50000, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 50000
                        regDate: user.RegistrationDate
                    };
                    
                    showMessage('loginMessage', `‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${email}`, 'success');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≤–∫–ª–∞–¥–∫–∏
                    document.getElementById('bankTab').style.display = 'inline-block';
                    document.getElementById('transferTab').style.display = 'inline-block';
                    document.getElementById('historyTab').style.display = 'inline-block';
                    document.getElementById('usersTab').style.display = 'inline-block';
                    document.getElementById('loginTab').style.display = 'none';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    setTimeout(() => {
                        showTab('bank');
                    }, 1000);
                    
                } else {
                    showMessage('loginMessage', '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showMessage('loginMessage', '‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', 'info');
                
                // –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ
                const localUsers = [
                    {ID: '1', Email: 'tilyas@mail.ru', Password: '80223', Balance: '50000'},
                    {ID: '2', Email: 'Prokhor@mail.ru', Password: '71601', Balance: '50000'},
                    {ID: '3', Email: 'Roma@mail.ru', Password: '23312', Balance: '50000'},
                    {ID: '4', Email: 'Artem@mail.ru', Password: '94331', Balance: '50000'}
                ];
                
                const user = localUsers.find(u => 
                    u.Email.toLowerCase() === email.toLowerCase() && 
                    u.Password === password
                );
                
                if (user) {
                    currentUser = {
                        id: user.ID,
                        email: user.Email,
                        password: user.Password,
                        balance: parseInt(user.Balance),
                        regDate: '2024-01-01'
                    };
                    
                    showMessage('loginMessage', `‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ (–¥–µ–º–æ-—Ä–µ–∂–∏–º)!`, 'success');
                    
                    document.getElementById('bankTab').style.display = 'inline-block';
                    document.getElementById('transferTab').style.display = 'inline-block';
                    document.getElementById('historyTab').style.display = 'inline-block';
                    document.getElementById('usersTab').style.display = 'inline-block';
                    document.getElementById('loginTab').style.display = 'none';
                    
                    setTimeout(() => {
                        showTab('bank');
                    }, 1000);
                } else {
                    showMessage('loginMessage', '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
                }
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function loadUsers() {
            try {
                // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ø–µ—Ä–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
                const users1 = await getSheetData(SHEET_ID, 'Users');
                
                if (users1.length > 0) {
                    allUsers = users1;
                } else {
                    // –ü—Ä–æ–±—É–µ–º –∏–∑ –≤—Ç–æ—Ä–æ–π —Ç–∞–±–ª–∏—Ü—ã
                    const users2 = await getSheetData(SHEET_ID_2, 'Users');
                    allUsers = users2;
                }
                
                // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ
                if (allUsers.length === 0) {
                    allUsers = [
                        {ID: '1', Email: 'tilyas@mail.ru', Password: '80223', Balance: '50000', RegistrationDate: '2024-01-01'},
                        {ID: '2', Email: 'Prokhor@mail.ru', Password: '71601', Balance: '50000', RegistrationDate: '2024-01-01'},
                        {ID: '3', Email: 'Roma@mail.ru', Password: '23312', Balance: '50000', RegistrationDate: '2024-01-01'},
                        {ID: '4', Email: 'Artem@mail.ru', Password: '94331', Balance: '50000', RegistrationDate: '2024-01-01'}
                    ];
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                allUsers = [
                    {ID: '1', Email: 'tilyas@mail.ru', Password: '80223', Balance: '50000'},
                    {ID: '2', Email: 'Prokhor@mail.ru', Password: '71601', Balance: '50000'},
                    {ID: '3', Email: 'Roma@mail.ru', Password: '23312', Balance: '50000'},
                    {ID: '4', Email: 'Artem@mail.ru', Password: '94331', Balance: '50000'}
                ];
            }
        }
        
        // –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–≤–æ–¥
        function quickTransfer(toEmail, amount) {
            if (!currentUser) return;
            
            document.getElementById('toEmail').value = toEmail;
            document.getElementById('amount').value = amount;
            showTab('transfer');
        }
        
        // –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥
        function makeTransfer() {
            if (!currentUser) {
                showMessage('transferMessage', '–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                return;
            }
            
            const toEmail = document.getElementById('toEmail').value.trim();
            const amount = parseInt(document.getElementById('amount').value);
            
            if (!toEmail || !amount || amount <= 0) {
                showMessage('transferMessage', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ', 'error');
                return;
            }
            
            if (amount > currentUser.balance) {
                showMessage('transferMessage', `‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤! –í–∞—à –±–∞–ª–∞–Ω—Å: ${currentUser.balance} ‚Çø`, 'error');
                return;
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è
            const receiver = allUsers.find(u => 
                u.Email && u.Email.trim().toLowerCase() === toEmail.toLowerCase()
            );
            
            if (!receiver) {
                showMessage('transferMessage', '‚ùå –ü–æ–ª—É—á–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }
            
            if (receiver.Email === currentUser.email) {
                showMessage('transferMessage', '‚ùå –ù–µ–ª—å–∑—è –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Å–∞–º–æ–º—É —Å–µ–±–µ', 'error');
                return;
            }
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–µ—Ä–µ–≤–æ–¥ (–ª–æ–∫–∞–ª—å–Ω–æ)
            currentUser.balance -= amount;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
            const transaction = {
                id: transactions.length + 1,
                from: currentUser.email,
                to: receiver.Email,
                amount: amount,
                date: new Date().toLocaleString('ru-RU'),
                status: 'success'
            };
            transactions.push(transaction);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            saveToLocalStorage();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateBankDisplay();
            updateTransferDisplay();
            
            showMessage('transferMessage', 
                `‚úÖ –ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!<br>
                <strong>${amount} ‚Çø</strong> ‚Üí <strong>${toEmail}</strong><br>
                –í–∞—à –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: <strong>${currentUser.balance} ‚Çø</strong>`, 
                'success'
            );
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            setTimeout(() => {
                document.getElementById('toEmail').value = '';
                document.getElementById('amount').value = '';
            }, 2000);
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
        function loadHistory() {
            const historyDiv = document.getElementById('historyList');
            
            if (!currentUser) {
                historyDiv.innerHTML = '<p class="error">–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</p>';
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage
            const savedTransactions = JSON.parse(localStorage.getItem('bankTransactions')) || [];
            const userTransactions = savedTransactions.filter(t => 
                t.from === currentUser.email || t.to === currentUser.email
            );
            
            if (userTransactions.length === 0) {
                historyDiv.innerHTML = '<p class="info">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</p>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            userTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = '';
            userTransactions.forEach(trans => {
                const isOutgoing = trans.from === currentUser.email;
                const type = isOutgoing ? 'üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ' : 'üì• –ü–æ–ª—É—á–µ–Ω–æ';
                const color = isOutgoing ? '#dc3545' : '#28a745';
                
                html += `
                    <div class="transaction">
                        <div><strong>${type}</strong></div>
                        <div>${isOutgoing ? '–ö–æ–º—É' : '–û—Ç'}: <strong>${isOutgoing ? trans.to : trans.from}</strong></div>
                        <div>–°—É–º–º–∞: <strong style="color:${color}">${trans.amount} ‚Çø</strong></div>
                        <div><small>${trans.date}</small></div>
                    </div>
                `;
            });
            
            historyDiv.innerHTML = html;
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function loadAllUsers() {
            const usersDiv = document.getElementById('usersList');
            
            if (allUsers.length === 0) {
                usersDiv.innerHTML = '<p class="info">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</p>';
                loadUsers();
                setTimeout(loadAllUsers, 1000);
                return;
            }
            
            let html = '';
            allUsers.forEach(user => {
                const isCurrent = currentUser && user.Email === currentUser.email;
                const balance = parseInt(user.Balance) || 50000;
                
                html += `
                    <div class="transaction" style="${isCurrent ? 'background:#e8f4fd;' : ''}">
                        <div><strong>${user.Email}</strong> ${isCurrent ? '(–í—ã)' : ''}</div>
                        <div>–ë–∞–ª–∞–Ω—Å: <strong>${balance} ‚Çø</strong></div>
                        ${user.RegistrationDate ? `<div><small>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${user.RegistrationDate}</small></div>` : ''}
                    </div>
                `;
            });
            
            usersDiv.innerHTML = html;
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –±–∞–Ω–∫–µ
        function updateBankDisplay() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.email;
                document.getElementById('balanceAmount').textContent = currentUser.balance;
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø–µ—Ä–µ–≤–æ–¥–µ
        function updateTransferDisplay() {
            if (currentUser) {
                document.getElementById('transferBalance').innerHTML = 
                    `–í–∞—à –±–∞–ª–∞–Ω—Å: <strong>${currentUser.balance} ‚Çø</strong>`;
            }
        }
        
        // –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            currentUser = null;
            
            document.getElementById('bankTab').style.display = 'none';
            document.getElementById('transferTab').style.display = 'none';
            document.getElementById('historyTab').style.display = 'none';
            document.getElementById('usersTab').style.display = 'none';
            document.getElementById('loginTab').style.display = 'inline-block';
            
            showTab('login');
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage
        function saveToLocalStorage() {
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('bankTransactions', JSON.stringify(transactions));
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage
        function loadFromLocalStorage() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                
                document.getElementById('bankTab').style.display = 'inline-block';
                document.getElementById('transferTab').style.display = 'inline-block';
                document.getElementById('historyTab').style.display = 'inline-block';
                document.getElementById('usersTab').style.display = 'inline-block';
                document.getElementById('loginTab').style.display = 'none';
                
                showTab('bank');
            }
            
            const savedTransactions = localStorage.getItem('bankTransactions');
            if (savedTransactions) {
                transactions = JSON.parse(savedTransactions);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(elementId, text, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = text;
            element.className = `message ${type}`;
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets
        async function getSheetData(sheetId, sheetName) {
            try {
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
                const response = await fetch(url);
                const text = await response.text();
                
                if (!text || text.length < 50) {
                    return [];
                }
                
                const json = JSON.parse(text.substr(47).slice(0, -2));
                
                if (!json.table || !json.table.rows) {
                    return [];
                }
                
                const headers = json.table.cols.map(col => col.label || '');
                return json.table.rows.map(row => {
                    const obj = {};
                    row.c.forEach((cell, index) => {
                        obj[headers[index]] = cell ? cell.v : '';
                    });
                    return obj;
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                return [];
            }
        }
        
        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            showTab('login');
            loadFromLocalStorage();
            loadUsers();
        };
    </script>
</body>
</html>
