<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>PayBank</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
--bg:#0b0b10;
--card:#17171f;
--input:#222230;
--accent:#ffd600;
--text:#fff;
--muted:#9b9ba3;
}

*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;}

body{
margin:0;
background:var(--bg);
color:var(--text);
min-height:100vh;
display:flex;
justify-content:center;
align-items:center;
}

.hidden{display:none;}

.tabs{
display:flex;
gap:8px;
margin-bottom:12px;
}

.tab{
flex:1;
padding:12px;
border-radius:14px;
border:none;
background:#2a2a36;
color:white;
cursor:pointer;
}

.tab.active{
background:var(--accent);
color:black;
font-weight:600;
}

.auth{background:var(--card);padding:28px;border-radius:22px;width:100%;max-width:360px;}

.auth input,.auth button{
width:100%;
margin-top:12px;
padding:14px;
border:none;
border-radius:14px;
}

.auth input{background:var(--input);color:white;}
.auth button{background:var(--accent);font-weight:600;cursor:pointer;}

.app{width:100%;max-width:420px;padding:16px;}

.card-wrap{perspective:1000px;}

.card{
width:100%;
height:170px;
border-radius:22px;
background:linear-gradient(135deg,#1e1e28,#121218);
padding:20px;
transition:.5s;
transform-style:preserve-3d;
cursor:pointer;
position:relative;
}

.card.flipped{transform:rotateY(180deg);}

.card-face{
position:absolute;
inset:0;
padding:20px;
backface-visibility:hidden;
}

.card-back{
transform:rotateY(180deg);
display:flex;
flex-direction:column;
justify-content:center;
}

.balance-title{color:var(--muted);}
.balance-amount{font-size:34px;}

.block{background:var(--card);border-radius:22px;padding:18px;margin-top:16px;}

.block input,.block select,.block button{
width:100%;
margin-top:12px;
padding:14px;
border:none;
border-radius:14px;
}

.block input,.block select{background:var(--input);color:white;}
.block button{background:var(--accent);font-weight:600;cursor:pointer;}

.logout{background:#2a2a36!important;color:white;}
</style>
</head>

<body>

<div class="auth" id="auth">
<h1>PayBank</h1>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
<button onclick="login()">–í–æ–π—Ç–∏</button>
</div>

<div class="app hidden" id="app">

<div class="tabs">
<button class="tab active" onclick="showTab('transfer',this)">üí≥</button>
<button class="tab" onclick="showTab('history',this)">üìú</button>
<button class="tab" onclick="showTab('nfc',this)">üì°</button>
</div>

<div class="card-wrap">
<div class="card" id="bankCard" onclick="flipCard()">
<div class="card-face">
<div class="balance-title">–ë–∞–ª–∞–Ω—Å</div>
<div class="balance-amount" id="balance">0 ‚ÇΩ</div>
</div>
<div class="card-face card-back">
<div class="balance-title">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</div>
<div class="balance-amount" id="cardNumber"></div>
</div>
</div>
</div>

<div id="transferTab">
<div class="block">
<select id="to"></select>
<input id="amount" type="number" placeholder="–°—É–º–º–∞">
<input id="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
<button onclick="transfer()">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
</div>
</div>

<div id="historyTab" class="hidden">
<div class="block">
<button onclick="toggleHistory()">–ü–æ–∫–∞–∑–∞—Ç—å / —Å–∫—Ä—ã—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã</button>
<div id="history"></div>
</div>
</div>

<div id="nfcTab" class="hidden">
<div class="block">
<button onclick="startNFC()">üì° –ü—Ä–∏–ª–æ–∂–∏—Ç—å –∫–∞—Ä—Ç—É</button>
<div id="nfcStatus">–û–∂–∏–¥–∞–Ω–∏–µ NFC...</div>
</div>
</div>

<div class="block">
<button onclick="downloadStatement()">–°–∫–∞—á–∞—Ç—å –≤—ã–ø–∏—Å–∫—É</button>
</div>

<button class="block logout" onclick="logout()">–í—ã–π—Ç–∏</button>

</div>

<script>
const API='https://script.google.com/macros/s/AKfycbzpREMs_CGdEJaD78SW7zzsepJdVh4cis93U9qdhz_uFBRPklq4YT3bf9jzmhUIEPRcPg/exec';

let userEmail='';
let autoUpdateInterval=null;

const emailInput=document.getElementById('email');
const passwordInput=document.getElementById('password');
const auth=document.getElementById('auth');
const app=document.getElementById('app');
const balance=document.getElementById('balance');
const cardNumber=document.getElementById('cardNumber');
const bankCard=document.getElementById('bankCard');
const to=document.getElementById('to');
const amount=document.getElementById('amount');
const comment=document.getElementById('comment');
const historyEl=document.getElementById('history');

function showTab(tab,btn){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
btn.classList.add('active');
transferTab.classList.add('hidden');
historyTab.classList.add('hidden');
nfcTab.classList.add('hidden');
if(tab==='transfer')transferTab.classList.remove('hidden');
if(tab==='history')historyTab.classList.remove('hidden');
if(tab==='nfc')nfcTab.classList.remove('hidden');
}

async function login(){
const r=await fetch(API,{method:'POST',body:JSON.stringify({action:'login',email:emailInput.value,password:passwordInput.value})});
const d=await r.json();
if(!d.success)return alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
userEmail=emailInput.value;
balance.textContent=d.balance+' ‚ÇΩ';
cardNumber.textContent=d.card;
auth.classList.add('hidden');
app.classList.remove('hidden');
}

async function transfer(){
await fetch(API,{method:'POST',body:JSON.stringify({
action:'transfer',
from:userEmail,
to:to.value,
amount:Number(amount.value),
comment:comment.value
})});
}

function startNFC(){
if("NDEFReader" in window){
document.getElementById('nfcStatus').textContent="üì° –ü–æ–¥–Ω–µ—Å–∏—Ç–µ –∫–∞—Ä—Ç—É...";
}else{
alert("NFC —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ Android Chrome");
}
}

function flipCard(){bankCard.classList.toggle('flipped');}

function logout(){
if(autoUpdateInterval) clearInterval(autoUpdateInterval);
location.reload();
}
</script>

</body>
</html>
