<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>PROFIT BANK 3.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --y: #ffd600; --bg: #0a0a0f; --card: #12121b; }
        body { margin:0; background:var(--bg); color:#fff; font-family:'Inter'; height:100vh; overflow:hidden; }
        .screen { height:100vh; display:flex; flex-direction:column; padding:15px; box-sizing:border-box; }
        
        /* КАРТА */
        .bank-card { 
            background: linear-gradient(135deg, #1a1a2e, #050508); 
            border-radius: 28px; padding: 25px; border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .bal-text { font-family:'Orbitron'; font-size:38px; font-weight:900; margin:10px 0; color:#fff; }
        .ava-circle { width:65px; height:65px; border-radius:50%; border:3px solid var(--y); object-fit:cover; float:right; background:#000; }

        /* КНОПКИ ТАБОВ */
        .tabs { display:flex; background:rgba(255,255,255,0.05); border-radius:15px; padding:5px; gap:5px; margin-bottom:15px; }
        .t-btn { flex:1; padding:12px; border:none; background:none; color:#555; font-weight:800; font-size:10px; border-radius:10px; text-transform:uppercase; cursor:pointer; }
        .t-btn.active { background:var(--y); color:#000; }

        /* КОНТЕНТ */
        .content { flex:1; overflow-y:auto; padding-bottom:20px; }
        .glass { background:var(--card); border-radius:24px; padding:20px; border:1px solid rgba(255,255,255,0.05); }
        
        input, select { width:100%; padding:16px; background:#000; border:1px solid rgba(255,255,255,0.1); border-radius:14px; color:#fff; margin-bottom:12px; font-size:16px; }
        .btn-main { width:100%; padding:18px; background:var(--y); border:none; border-radius:14px; font-weight:900; text-transform:uppercase; cursor:pointer; }

        /* ЧАТ */
        .chat-msg { display:flex; gap:10px; margin-bottom:15px; align-items:flex-end; }
        .chat-msg.me { flex-direction:row-reverse; }
        .c-ava { width:36px; height:36px; border-radius:50%; border:2px solid var(--y); background:#222; object-fit:cover; }
        .c-bubble { background:#1c1c28; padding:12px 16px; border-radius:18px; font-size:14px; max-width:75%; }
        .chat-msg.me .c-bubble { background:var(--y); color:#000; font-weight:600; }

        .hidden { display:none !important; }
    </style>
</head>
<body>

<div id="scr-login" class="screen" style="justify-content:center;">
    <div class="glass" style="text-align:center;">
        <h1 style="font-family:'Orbitron'; color:var(--y); margin-bottom:30px;">PROFIT LOGIN</h1>
        <input type="text" id="log-email" placeholder="Email (romankisel@mail.ru)">
        <input type="password" id="log-pass" placeholder="Пароль">
        <button class="btn-main" onclick="auth()">ВОЙТИ В СИСТЕМУ</button>
    </div>
</div>

<div id="scr-main" class="screen hidden">
    <div class="bank-card">
        <img id="my-photo" class="ava-circle" src="">
        <div style="color:#666; font-size:11px; letter-spacing:1px; font-weight:700;">ДОСТУПНО СЕЙЧАС</div>
        <div class="bal-text" id="my-bal">0 ₽</div>
        <div id="my-name" style="color:var(--y); font-weight:800; font-size:13px; text-transform:uppercase;">NAME</div>
    </div>

    <div class="tabs">
        <button class="t-btn active" onclick="tab('pay',this)">ПЛАТЕЖ</button>
        <button class="t-btn" onclick="tab('chat',this)">ЧАТ</button>
        <button class="t-btn" onclick="tab('prof',this)">ПРОФИЛЬ</button>
    </div>

    <div class="content">
        <div id="v-pay" class="glass">
            <select id="send-to">
                <option value="ilyasvaliev@mail.ru">Ильяс Валиев</option>
                <option value="artemant@mail.ru">Артем Ант</option>
            </select>
            <input type="number" id="send-amt" placeholder="Сумма перевода">
            <button class="btn-main" onclick="transfer()">ВЫПОЛНИТЬ МГНОВЕННО</button>
        </div>

        <div id="v-chat" class="glass hidden">
            <div id="chat-box" style="display:flex; flex-direction:column; min-height:200px;"></div>
            <div style="display:flex; gap:8px; margin-top:15px;">
                <input type="text" id="msg-val" placeholder="Сообщение..." style="margin:0;">
                <button class="btn-main" style="width:60px; padding:0;" onclick="sendChat()">></button>
            </div>
        </div>

        <div id="v-prof" class="glass hidden">
            <button class="btn-main" style="background:#1a1a2e; color:var(--y); border:1px solid var(--y);" onclick="makeAva()">СДЕЛАТЬ НОВОЕ ФОТО</button>
            <p style="font-size:10px; color:#555; text-align:center; margin-top:10px;">ФОТО ОБНОВИТСЯ ВО ВСЕХ ТАБЛИЦАХ</p>
        </div>
    </div>
</div>

<script>
const API = 'ТВОЯ_ССЫЛКА_ИЗ_DEPLOY';
let user = null;

// 1. АВТОРИЗАЦИЯ
async function auth() {
    const email = document.getElementById('log-email').value;
    const pass = document.getElementById('log-pass').value;
    const res = await fetch(API, {method:'POST', body: JSON.stringify({action:'login', email, pass})});
    const d = await res.json();
    if(d.success) {
        user = { email, ...d };
        document.getElementById('scr-login').classList.add('hidden');
        document.getElementById('scr-main').classList.remove('hidden');
        updateUI();
        loop();
        setInterval(loop, 5000);
    } else alert("Ошибка входа!");
}

// 2. ОБНОВЛЕНИЕ ЭКРАНА
function updateUI() {
    document.getElementById('my-bal').innerText = Number(user.bal).toLocaleString() + ' ₽';
    document.getElementById('my-name').innerText = user.name;
    document.getElementById('my-photo').src = user.ava || 'https://via.placeholder.com/65';
}

// 3. МГНОВЕННЫЙ ПЕРЕВОД
async function transfer() {
    const amt = Number(document.getElementById('send-amt').value);
    if(amt > user.bal) return alert("Недостаточно средств!");
    
    // Эффект моментальности
    user.bal -= amt;
    updateUI();
    
    await fetch(API, {method:'POST', body: JSON.stringify({
        action:'transfer', from: user.email, to: document.getElementById('send-to').value, amount: amt
    })});
    document.getElementById('send-amt').value = '';
}

// 4. СИНХРОНИЗАЦИЯ
async function loop() {
    const res = await fetch(API, {method:'POST', body: JSON.stringify({action:'sync', email: user.email})});
    const d = await res.json();
    user.bal = d.bal;
    user.ava = d.ava;
    updateUI();
    
    document.getElementById('chat-box').innerHTML = d.chat.map(m => `
        <div class="chat-msg ${m.name === user.name ? 'me' : ''}">
            <img class="c-ava" src="${m.ava || 'https://via.placeholder.com/36'}">
            <div class="c-bubble">${m.text}</div>
        </div>
    `).join('');
}

// 5. ОТПРАВКА В ЧАТ
async function sendChat() {
    const val = document.getElementById('msg-val').value;
    if(!val) return;
    document.getElementById('msg-val').value = '';
    await fetch(API, {method:'POST', body: JSON.stringify({
        action:'chat_send', email: user.email, name: user.name, text: val
    })});
    loop();
}

function tab(id, el) {
    document.querySelectorAll('.glass').forEach(g => g.classList.add('hidden'));
    document.getElementById('v-'+id).classList.remove('hidden');
    document.querySelectorAll('.t-btn').forEach(b => b.classList.remove('active'));
    el.classList.add('active');
}

async function makeAva() {
    const s = await navigator.mediaDevices.getUserMedia({video:true});
    const v = document.createElement('video'); v.srcObject = s; await v.play();
    setTimeout(async () => {
        const c = document.createElement('canvas'); c.width=400; c.height=400;
        c.getContext('2d').drawImage(v,0,0,400,400);
        const img = c.toDataURL('image/jpeg', 0.5);
        user.ava = img; updateUI();
        await fetch(API, {method:'POST', body: JSON.stringify({action:'updateAva', email:user.email, img})});
        s.getTracks().forEach(t => t.stop());
        alert("Профиль обновлен!");
    }, 1000);
}
</script>
</body>
</html>
