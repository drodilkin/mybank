<!DOCTYPE html>
<html>
<head>
    <title>–ú–æ–π –ë–∞–Ω–∫</title>
    <style>
        body { font-family: Arial; max-width: 500px; margin: auto; padding: 20px; }
        .card { background: #e3f2fd; padding: 20px; margin: 15px 0; border-radius: 10px; }
        input, button { width: 100%; padding: 12px; margin: 8px 0; }
        .balance { font-size: 28px; color: #2e7d32; }
    </style>
</head>
<body>
    <h1>üè¶ –ú–æ–π –ë–∞–Ω–∫ (Google Sheets)</h1>
    
    <div class="card">
        <h3>–í—Ö–æ–¥:</h3>
        <input id="email" placeholder="Email" value="you@test.com">
        <input id="password" placeholder="–ü–∞—Ä–æ–ª—å" value="123">
        <button onclick="login()">–í–æ–π—Ç–∏</button>
    </div>
    
    <div id="bank" style="display:none">
        <div class="card">
            <h3>üë§ <span id="userName"></span></h3>
            <div class="balance">üí∞ <span id="balance">0</span> –±–∞–ª–ª–æ–≤</div>
        </div>
        
        <div class="card">
            <h3>üì§ –ü–µ—Ä–µ–≤–æ–¥ –¥—Ä—É–≥—É:</h3>
            <input id="friendEmail" placeholder="Email –¥—Ä—É–≥–∞" value="friend@test.com">
            <input id="amount" type="number" placeholder="–°—É–º–º–∞" value="100">
            <button onclick="sendMoney()">üí∏ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
        </div>
        
        <div id="result" class="card" style="background: #e8f5e9; display:none"></div>
        
        <button onclick="logout()" style="background: #d32f2f; color: white;">–í—ã–π—Ç–∏</button>
    </div>

    <script>
        // ==== –í–°–¢–ê–í–¨ –°–Æ–î–ê ID –°–í–û–ï–ô –¢–ê–ë–õ–ò–¶–´ ====
        const GOOGLE_SHEET_ID = '1CUB6u5owXML_RulAk6OzoSvZTXTmUdzARzt8UzVyvGI';
        // –ü—Ä–∏–º–µ—Ä: '1A2B3C4D5E6F7G8H9I0J'
        // ======================================
        
        let currentUser = null;
        let allUsers = [];
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets
        async function loadData() {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ
                const url = `https://docs.google.com/spreadsheets/d/1CUB6u5owXML_RulAk6OzoSvZTXTmUdzARzt8UzVyvGI/edit?usp=drivesdk`;
                
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substr(47).slice(0, -2));
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ
                allUsers = [];
                const rows = json.table.rows;
                
                for (let row of rows) {
                    const user = {
                        email: row.c[0]?.v || '',
                        password: row.c[1]?.v || '',
                        name: row.c[2]?.v || '',
                        balance: row.c[3]?.v || 0
                    };
                    if (user.email) allUsers.push(user);
                }
                
                console.log('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', allUsers);
                return allUsers;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                allUsers = [
                    { email: 'you@test.com', password: '123', name: '–í—ã', balance: 1000 },
                    { email: 'friend@test.com', password: '123', name: '–î—Ä—É–≥', balance: 0 }
                ];
                return allUsers;
            }
        }
        
        // –í–æ–π—Ç–∏
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            await loadData();
            
            const user = allUsers.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                document.querySelector('.card').style.display = 'none';
                document.getElementById('bank').style.display = 'block';
                document.getElementById('userName').textContent = user.name;
                document.getElementById('balance').textContent = user.balance;
                showResult('‚úÖ –í–æ—à–ª–∏ –∫–∞–∫: ' + user.name);
            } else {
                showResult('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
            }
        }
        
        // –ü–µ—Ä–µ–≤–µ—Å—Ç–∏
        async function sendMoney() {
            const friendEmail = document.getElementById('friendEmail').value;
            const amount = parseInt(document.getElementById('amount').value);
            
            await loadData();
            
            const friend = allUsers.find(u => u.email === friendEmail);
            
            if (!friend) {
                showResult('‚ùå –î—Ä—É–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            if (amount > currentUser.balance) {
                showResult('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –ø–∞–º—è—Ç–∏
            currentUser.balance -= amount;
            friend.balance += amount;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            document.getElementById('balance').textContent = currentUser.balance;
            
            // –í –î–ï–ú–û-–†–ï–ñ–ò–ú–ï –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Google Sheets
            // –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä
            
            showResult(
                '‚úÖ –ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!<br>' +
                'üì§ –í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏: ' + amount + ' –±–∞–ª–ª–æ–≤<br>' +
                'üë§ –î—Ä—É–≥—É: ' + friend.name + '<br>' +
                'üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: ' + currentUser.balance + ' –±–∞–ª–ª–æ–≤<br><br>' +
                'üì± –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä (–ø–∏—à–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)'
            );
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        function showResult(message) {
            const result = document.getElementById('result');
            result.style.display = 'block';
            result.innerHTML = message;
        }
        
        // –í—ã–π—Ç–∏
        function logout() {
            currentUser = null;
            document.getElementById('bank').style.display = 'none';
            document.querySelector('.card').style.display = 'block';
        }
    </script>
</body>
</html>
